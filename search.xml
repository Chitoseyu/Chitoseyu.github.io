<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>1146. Snapshot Array PHP解題</title>
    <url>/2023/06/11/1146-Snapshot%20Array/</url>
    <content><![CDATA[<h1 id="題目說明"><a href="#題目說明" class="headerlink" title="題目說明"></a>題目說明</h1><p>Implement a SnapshotArray that supports the following interface:</p>
<ul>
<li>SnapshotArray(int length) initializes an array-like data structure with the given length. Initially, each element equals 0.</li>
<li>void set(index, val) sets the element at the given index to be equal to val.</li>
<li>int snap() takes a snapshot of the array and returns the snap_id: the total number of times we called snap() minus 1.</li>
<li>int get(index, snap_id) returns the value at the given index, at the time we took the snapshot with the given snap_id</li>
</ul>
<span id="more"></span>

<p>Input / Output(測試資料輸入/輸出):</p>
<pre><code>Input: [&quot;SnapshotArray&quot;,&quot;set&quot;,&quot;snap&quot;,&quot;set&quot;,&quot;get&quot;]
[[3],[0,5],[],[0,6],[0,0]]
Output: [null,null,0,null,5]
Explanation: 
SnapshotArray snapshotArr = new SnapshotArray(3); // set the length to be 3
snapshotArr.set(0,5);  // Set array[0] = 5
snapshotArr.snap();  // Take a snapshot, return snap_id = 0
snapshotArr.set(0,6);
snapshotArr.get(0,0);  // Get the value of array[0] with snap_id = 0, return 5
</code></pre>
<p>Constraints(參數限制):</p>
<ul>
<li>1 &lt;= length &lt;= 5 * 104</li>
<li>0 &lt;= index &lt; length</li>
<li>0 &lt;= val &lt;= 109</li>
<li>0 &lt;= snap_id &lt; (the total number of times we call snap())<br>  At most 5 * 104 calls will be made to set, snap, and get.</li>
</ul>
<h1 id="解題思路"><a href="#解題思路" class="headerlink" title="解題思路"></a>解題思路</h1><p>要做出一個可以快照目前陣列內容的功能，以下就個別功能說明</p>
<h2 id="SnapshotArray-int-length"><a href="#SnapshotArray-int-length" class="headerlink" title="SnapshotArray(int length)"></a>SnapshotArray(int length)</h2><p>初始化陣列，length 會等於 陣列總長度，初始陣列為全部 0。</p>
<h2 id="set-index-val"><a href="#set-index-val" class="headerlink" title="set(index, val)"></a>set(index, val)</h2><p>依照輸入的 val 來設置 陣列[index] 的數值</p>
<h2 id="snap"><a href="#snap" class="headerlink" title="snap()"></a>snap()</h2><p>對目前資料陣列進行快照動作，回傳數值為 目前快照次數 - 1;</p>
<h2 id="get-index-snap-id"><a href="#get-index-snap-id" class="headerlink" title="get(index, snap_id)"></a>get(index, snap_id)</h2><p>取得目前在 snap_id 下該陣列[index] 的數值</p>
<p>此題目的測試範圍不小，且有記憶體限制，記錄太多東西執行上就會超時，<br>那節省記憶體的陣列做法是將資料存成二維陣列，資料除了設置的數值外多存一個快照ID，取資料的時候會用到(快照ID=snap_id)，此時將對應的陣列[index]傳進去，利用二分搜尋法查詢 符合條件的snap_id數值就能找到資料了！</p>
<h1 id="程式碼"><a href="#程式碼" class="headerlink" title="程式碼"></a>程式碼</h1><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SnapshotArray</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> Integer $length</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$length</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;snap_c = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="variable">$length</span>;<span class="variable">$i</span>++)&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;snap_array[<span class="variable">$i</span>][] = [<span class="number">0</span>,<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> Integer $index</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> Integer $val</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> NULL</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">set</span>(<span class="params"><span class="variable">$index</span>, <span class="variable">$val</span></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">$this</span>-&gt;snap_array[<span class="variable">$index</span>][] = [<span class="keyword">$this</span>-&gt;snap_c,<span class="variable">$val</span>];  </span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Integer</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">snap</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;snap_c++;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> Integer $index</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> Integer $snap_id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Integer</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"><span class="variable">$index</span>, <span class="variable">$snap_id</span></span>) </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;getData(<span class="keyword">$this</span>-&gt;snap_array[<span class="variable">$index</span>],<span class="variable">$snap_id</span>)[<span class="number">1</span>];</span><br><span class="line">       </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">getData</span>(<span class="params"><span class="variable">$arr</span>,<span class="variable">$target</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$max</span> = count(<span class="variable">$arr</span>);</span><br><span class="line">        <span class="variable">$min</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(<span class="variable">$min</span> &lt; <span class="variable">$max</span>)&#123;</span><br><span class="line">            <span class="variable">$mid</span> = <span class="variable">$min</span> + floor( (<span class="variable">$max</span> - <span class="variable">$min</span> ) /<span class="number">2</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$arr</span>[<span class="variable">$mid</span>][<span class="number">0</span>] &lt;= <span class="variable">$target</span>)&#123;</span><br><span class="line">                <span class="variable">$min</span> = <span class="variable">$mid</span> + <span class="number">1</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="variable">$max</span> = <span class="variable">$mid</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$arr</span>[<span class="variable">$min</span>-<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>解題紀錄</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
      </tags>
  </entry>
  <entry>
    <title>155. Min Stack javascript解題</title>
    <url>/2021/11/08/155-Min-Stack-javascript/</url>
    <content><![CDATA[<h1 id="題目說明"><a href="#題目說明" class="headerlink" title="題目說明"></a>題目說明</h1><p>Design a stack that supports push, pop, top, and retrieving the minimum element in constant time.</p>
<p>Implement the MinStack class:</p>
<ul>
<li>MinStack() initializes the stack object.</li>
<li>void push(int val) pushes the element val onto the stack.</li>
<li>void pop() removes the element on the top of the stack.</li>
<li>int top() gets the top element of the stack.</li>
<li>int getMin() retrieves the minimum element in the stack.</li>
</ul>
<span id="more"></span>

<p>Input / Output(測試資料輸入/輸出):</p>
<pre><code>MinStack minStack = new MinStack();
minStack.push(-2);
minStack.push(0);
minStack.push(-3);
minStack.getMin(); // return -3
minStack.pop();
minStack.top();    // return 0
minStack.getMin(); // return -2
</code></pre>
<p>Constraints(參數限制):</p>
<ul>
<li>-231 &lt;= val &lt;= 231 - 1</li>
<li>Methods pop, top and getMin operations will always be called on non-empty stacks.</li>
<li>At most 3 * 104 calls will be made to push, pop, top, and getMin.</li>
</ul>
<h1 id="解題思路"><a href="#解題思路" class="headerlink" title="解題思路"></a>解題思路</h1><p>在Leetcode算Easy的題目，複習Stack堆疊先進後出的觀念，以下以實作上較特別的功能函數做說明</p>
<h2 id="push"><a href="#push" class="headerlink" title="push()"></a>push()</h2><p>每次推之前都檢查推的值是否比 min 存的值還小，有就存進去</p>
<p>所以 min 最底層永遠是最小值</p>
<h2 id="pop"><a href="#pop" class="headerlink" title="pop()"></a>pop()</h2><p>每次移除最後一個值之前都檢查移除的值是否與 min 存的值相等，有就順便移除掉</p>
<p>最後一個值 =&gt; 最早 push 進堆疊的數值 =&gt;  維持 min 裡面最後一項永遠最小</p>
<h1 id="程式碼"><a href="#程式碼" class="headerlink" title="程式碼"></a>程式碼</h1><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> MinStack = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;  </span><br><span class="line">    <span class="built_in">this</span>.stack = [];</span><br><span class="line">    <span class="built_in">this</span>.min = [];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">MinStack.prototype.push = <span class="function"><span class="keyword">function</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">this</span>.min.length === <span class="number">0</span> || val &lt;= <span class="built_in">this</span>.getMin())&#123;</span><br><span class="line">        <span class="built_in">this</span>.min.push(val);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">this</span>.stack.push(val);</span><br><span class="line">&#125;; </span><br><span class="line"></span><br><span class="line">MinStack.prototype.pop = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">     <span class="keyword">if</span>(<span class="built_in">this</span>.getMin()  === <span class="built_in">this</span>.top())&#123;</span><br><span class="line">        <span class="built_in">this</span>.min.pop();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">this</span>.stack.pop();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">MinStack.prototype.top = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span>  <span class="built_in">this</span>.stack[ <span class="built_in">this</span>.stack.length-<span class="number">1</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">MinStack.prototype.getMin = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">     <span class="keyword">return</span>  <span class="built_in">this</span>.min[ <span class="built_in">this</span>.min.length-<span class="number">1</span>];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>解題紀錄</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
      </tags>
  </entry>
  <entry>
    <title>Laravel Route 解析頁面錯誤？三步驟快速排查！</title>
    <url>/2025/03/15/Laravel%20Route%20%E7%84%A1%E6%B3%95%E8%A7%A3%E6%9E%90%E9%A0%81%E9%9D%A2%EF%BC%9F%E9%80%99%203%20%E6%8B%9B%E5%B9%AB%E4%BD%A0%E5%BF%AB%E9%80%9F%E6%8E%92%E6%9F%A5%EF%BC%81/</url>
    <content><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>筆者在 Laravel 開發 API 應用時，</p>
<p>有遇到 <strong>Route 無法正常解析</strong>，導致網頁導向請求一直失敗的情況。</p>
<p>那時候真的是摸不清問題在哪，於是便有了整理此篇文章的想法，</p>
<p>這篇文章將針對 <strong>路由無法正常運作</strong> 問題，提供 3 個排查步驟，希望能幫到同樣有困難的人。</p>
<span id="more"></span>

<h1 id="排查步驟"><a href="#排查步驟" class="headerlink" title="排查步驟"></a>排查步驟</h1><p>以可能發生的問題做進一步檢查，可分成以下項目</p>
<h2 id="檢查-api-php-是否能夠解析請求"><a href="#檢查-api-php-是否能夠解析請求" class="headerlink" title="檢查 api.php 是否能夠解析請求"></a><strong>檢查 <code>api.php</code> 是否能夠解析請求</strong></h2><p>首先確認 API 路由 (<code>routes/api.php</code>) 是否正確被 Laravel 載入，<br>可以使用 Artisan 指令列出所有已註冊的路由：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">php artisan route:list --except-hidden</span><br></pre></td></tr></table></figure>

<p>這個指令會列出所有可用的 API 路由，如果 API 路由沒有出現在列表中，可能有以下的問題：</p>
<ul>
<li><p><strong>未定義正確的 API 路由</strong></p>
<p>  請確保 <code>routes/api.php</code> 檔案內有適當的路由。例如：    </p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Facades</span>\<span class="title">Route</span>;</span><br><span class="line"></span><br><span class="line">Route::get(<span class="string">&#x27;/test&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> response()-&gt;json([<span class="string">&#x27;message&#x27;</span> =&gt; <span class="string">&#x27;API 路由正常運作&#x27;</span>]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>請求 URL 是否包含 <code>/api</code> 前綴？</strong> </p>
<p>  Laravel 預設會將 <code>api.php</code> 內的路由加上 <code>/api</code> 前綴，例如：    </p>
  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">正確：GET http://yourdomain.com/api/test</span><br><span class="line">錯誤：GET http://yourdomain.com/test</span><br></pre></td></tr></table></figure>
<p>  如果不希望有 <code>/api</code>，可以修改 <code>RouteServiceProvider.php</code></p>
</li>
</ul>
<h2 id="檢查-RouteServiceProvider-php-是否正確載入-API-路由"><a href="#檢查-RouteServiceProvider-php-是否正確載入-API-路由" class="headerlink" title="檢查 RouteServiceProvider.php 是否正確載入 API 路由"></a><strong>檢查 <code>RouteServiceProvider.php</code> 是否正確載入 API 路由</strong></h2><p>Laravel 的 <code>RouteServiceProvider</code> 負責載入所有的路由檔案，</p>
<p>其中 <code>mapApiRoutes()</code> 方法應該確保 <code>api.php</code> 正確載入。</p>
<p>請開啟 <code>app/Providers/RouteServiceProvider.php</code>，找到 <code>mapApiRoutes()</code> 方法，確認內容如下：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">mapApiRoutes</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Route::middleware(<span class="string">&#x27;api&#x27;</span>)</span><br><span class="line">        -&gt;prefix(<span class="string">&#x27;api&#x27;</span>)</span><br><span class="line">        -&gt;group(base_path(<span class="string">&#x27;routes/api.php&#x27;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>確認 <code>prefix(&#39;api&#39;)</code> 是否正確設定</strong></li>
<li><strong>檢查 <code>middleware(&#39;api&#39;)</code> 是否存在</strong></li>
<li><strong>確認 <code>group(base_path(&#39;routes/api.php&#39;))</code> 指向正確路徑</strong></li>
</ul>
<p>如果有做任何修改，請執行以下指令清除快取並重新載入路由：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">php artisan route:clear</span><br><span class="line">php artisan cache:clear</span><br><span class="line">php artisan config:clear</span><br></pre></td></tr></table></figure>

<h2 id="檢查-htaccess-是否正確導向請求"><a href="#檢查-htaccess-是否正確導向請求" class="headerlink" title="檢查 .htaccess 是否正確導向請求"></a><strong>檢查 <code>.htaccess</code> 是否正確導向請求</strong></h2><p>如果使用的是 Apache 伺服器，Laravel 需要 <code>.htaccess</code> 來將所有請求導向 <code>public/index.php</code>。</p>
<p>確認 <code>public/.htaccess</code> 檔案是否存在，內容如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;IfModule mod_rewrite.c&gt;</span><br><span class="line">    RewriteEngine On</span><br><span class="line">    RewriteRule ^(.*)$ public/$1 [L]</span><br><span class="line">&lt;/IfModule&gt;</span><br></pre></td></tr></table></figure>

<p>如果 <code>.htaccess</code> 不存在，可能導致 <strong>Laravel 無法正確解析路由</strong>，可以手動新增並填入上述內容。</p>
<p>此外也要確保 Apache 伺服器的 <strong>mod_rewrite</strong> 模組已啟用，</p>
<p>可使用以下指令檢查：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">apachectl -M | grep rewrite</span><br></pre></td></tr></table></figure>

<p>如果未啟用，<br>可以在 Apache 設定 (<code>/etc/apache2/apache2.conf</code> 或 <code>/etc/httpd/conf/httpd.conf</code>) 中新增：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">LoadModule rewrite_module modules/mod_rewrite.so</span><br></pre></td></tr></table></figure>

<p>並重新啟動 Apache：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo systemctl restart apache2</span><br><span class="line">sudo systemctl restart httpd</span><br></pre></td></tr></table></figure>

<h1 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h1><p>當 Laravel API 路由無法解析時，可以透過上述的步驟來排查：</p>
<p>若有一步步確認問題點，應該能解決 Laravel 路由無法解析的問題！</p>
<p>如果文章有其他錯誤的地方，也請不吝留言告知 😊</p>
]]></content>
      <categories>
        <category>技術筆記</category>
      </categories>
      <tags>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title>Markdown語法筆記</title>
    <url>/2021/04/07/Markdown%E8%AA%9E%E6%B3%95%E7%AD%86%E8%A8%98/</url>
    <content><![CDATA[<p>整理一些比較常用的語法紀錄</p>
<hr>
<h1 id="標題"><a href="#標題" class="headerlink" title="標題"></a>標題</h1><p><strong>#當標題使用，越少字越大，最多6個</strong></p>
<pre><code>## 第二段 (H2)
### 第三段(H3)
</code></pre>
<p>效果如下</p>
<h2 id="第二段-H2"><a href="#第二段-H2" class="headerlink" title="第二段 (H2)"></a>第二段 (H2)</h2><h3 id="第三段-H3"><a href="#第三段-H3" class="headerlink" title="第三段(H3)"></a>第三段(H3)</h3><span id="more"></span>


<h1 id="刪除線"><a href="#刪除線" class="headerlink" title="刪除線"></a>刪除線</h1><p><strong>句子前後都加 ~~ 會有刪除線效果</strong></p>
<pre><code>~~我是刪除線~~
</code></pre>
<p>效果如下</p>
<p><del>我是刪除線</del></p>
<h1 id="常用文字效果"><a href="#常用文字效果" class="headerlink" title="常用文字效果"></a>常用文字效果</h1><h2 id="粗體"><a href="#粗體" class="headerlink" title="粗體"></a>粗體</h2><pre><code>**Bold**  or __Bold__
</code></pre>
<p>效果如下</p>
<p><strong>Bold</strong></p>
<h2 id="斜體"><a href="#斜體" class="headerlink" title="斜體"></a>斜體</h2><pre><code>*Italic*  or _Italic_
</code></pre>
<p>效果如下</p>
<p><em>Italic</em></p>
<h2 id="字體顏色"><a href="#字體顏色" class="headerlink" title="字體顏色"></a>字體顏色</h2><p>這部分可以直接套用HTML語法，顏色可以參考<a href="https://www.ifreesite.com/color/">網頁色碼表</a></p>
<pre><code>* &lt;font color = &quot;#FF0000&quot;&gt;紅色文字&lt;/font&gt;
* &lt;font color = &quot;00A600&quot;&gt;綠色文字&lt;/font&gt;
* &lt;font color = &quot;#0000C6&quot;&gt;藍色文字&lt;/font&gt;
</code></pre>
<p>效果如下 </p>
<ul>
<li><font color = "#FF0000">紅色文字</font></li>
<li><font color = "00A600">綠色文字</font></li>
<li><font color = "#0000C6">藍色文字</font></li>
</ul>
<h2 id="特殊符號"><a href="#特殊符號" class="headerlink" title="特殊符號"></a>特殊符號</h2><p>**如果需要打特殊符號但跟前面的有重複到，記得在符號前加上反斜線 \ ，特殊符號如下 **</p>
<pre><code>*
!
+
-
[]
&#123;&#125;
#
!
</code></pre>
<h2 id="區塊引言"><a href="#區塊引言" class="headerlink" title="區塊引言"></a>區塊引言</h2><p>** 在每行前面 加上 &gt; 或是在區塊的第一行加上 &gt; **</p>
<pre><code>&gt; 哈哈
&gt; 區塊引言
&gt; &gt; 多加就會換行
</code></pre>
<p>效果如下</p>
<blockquote>
<p>哈哈<br>區塊引言</p>
<blockquote>
<p>多加就會換行</p>
</blockquote>
</blockquote>
<h2 id="分隔線"><a href="#分隔線" class="headerlink" title="分隔線"></a>分隔線</h2><p><strong>分隔線的部分就很自由了，只要有三個以上的 * or _ or - 都會出來，不管中間有沒有空格</strong> </p>
<pre><code>***
_ _ _ _ _
------------
</code></pre>
<p>效果如下</p>
<hr>
<h1 id="清單"><a href="#清單" class="headerlink" title="清單"></a>清單</h1><p><strong>前面一個 * or + or - 當一般清單(就是沒有1.、2.、3.、…etc)</strong></p>
<pre><code>* 第一個
 * 第二個
* 第三個
</code></pre>
<p>效果如下</p>
<ul>
<li>第一個</li>
<li>第二個</li>
<li>第三個</li>
</ul>
<p><strong>想要有序清單就正常打</strong></p>
<pre><code>1. 第一個
2. 第二個
</code></pre>
<p>效果如下   </p>
<ol>
<li>第一個</li>
<li>第二個</li>
</ol>
<h1 id="文字大區塊"><a href="#文字大區塊" class="headerlink" title="文字大區塊"></a>文字大區塊</h1><p><strong>要用大區塊將文字包起來可以按四個空白或是一個Tab</strong></p>
<pre><code>echo &quot;Hello World!&quot;
</code></pre>
<h1 id="文字小區塊"><a href="#文字小區塊" class="headerlink" title="文字小區塊"></a>文字小區塊</h1><p><strong>要用小區塊將文字包起來前後都加上 ` 反引號</strong></p>
<p><code>echo &quot;Hello World!&quot;</code></p>
<h1 id="程式碼區塊"><a href="#程式碼區塊" class="headerlink" title="程式碼區塊"></a>程式碼區塊</h1><p><strong>程式碼區塊在開頭結尾加上```可以顯示</strong></p>
<p>要加上Highlight  以JS為例就是 js 或 javascript 在前面的 ``` 加上 js 或 javascript 就有囉</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">document</span>.write(<span class="string">&quot;歡迎光臨&quot;</span>) </span><br></pre></td></tr></table></figure>
<h1 id="超連結"><a href="#超連結" class="headerlink" title="超連結"></a>超連結</h1><p><strong>需要超連結的格式</strong></p>
<p><code>[要顯示的名稱](網址)</code></p>
<h1 id="圖片"><a href="#圖片" class="headerlink" title="圖片"></a>圖片</h1><p><code>![若圖片顯示不出來的文字](圖片連結位置或網址)</code></p>
<p>效果如下，用原生的沒辦法設定大小，可以改用HTML的　img　標籤來設定</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;圖片網誌或存放路徑&quot;</span>  <span class="attr">width</span>=<span class="string">&quot;300&quot;</span> <span class="attr">height</span>=<span class="string">&quot;300&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="HTML的img做出來的效果"><a href="#HTML的img做出來的效果" class="headerlink" title="HTML的img做出來的效果"></a>HTML的img做出來的效果</h2><img src="https://i.imgur.com/8Kwd2ko.jpg"  width="300" height="300">

<h2 id="Markdown做出來的效果"><a href="#Markdown做出來的效果" class="headerlink" title="Markdown做出來的效果"></a>Markdown做出來的效果</h2><p><img src="https://i.imgur.com/8Kwd2ko.jpg" alt="沒錯原生圖檔就這麼大"></p>
<h1 id="參考資料"><a href="#參考資料" class="headerlink" title="參考資料"></a>參考資料</h1><p><a href="https://markdown.tw/">Markdown語法說明</a></p>
]]></content>
      <categories>
        <category>技術筆記</category>
      </categories>
      <tags>
        <tag>Markdown</tag>
      </tags>
  </entry>
  <entry>
    <title>MongoDB入門手冊</title>
    <url>/2021/08/19/MongoDB%E5%85%A5%E9%96%80%E6%89%8B%E5%86%8A/</url>
    <content><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>照慣例在文章開頭放個圖片</p>
<p><img src="/images/mongodb.png"></p>
<p>作為近幾年開始熱門討論的 NoSQL資料庫，有非常強大的社群及網路討論聲量，本身也有分成安裝版跟免安裝版本，大部分網路上教學都是安裝版，因為有安裝就會有預設路徑 = 少做路徑設定</p>
<p>對於第一次操作的人可能都會是這個表情，這就是學習新技術痛苦的地方啊…<br><img src="/images/cat.jpg"  width="300" height="300"></p>
<p>我在操作時使用免安裝版，優點就是可以隨時帶著走，但路徑出錯直接運作不起來</p>
<p>這部分就交給讀者自行選擇版本囉 ~ </p>
<p>在學習途中做個資料整理，提供正在學的人能避免做無用功浪費時間，有錯誤歡迎留言指正！</p>
<span id="more"></span>
<hr>
<h1 id="MongoDB設定細節"><a href="#MongoDB設定細節" class="headerlink" title="MongoDB設定細節"></a>MongoDB設定細節</h1><h2 id="安裝本機背景服務設定-Windows環境下-："><a href="#安裝本機背景服務設定-Windows環境下-：" class="headerlink" title="安裝本機背景服務設定(Windows環境下)："></a>安裝本機背景服務設定(Windows環境下)：</h2><p>讓MongoDB可以在背景啟動，mongodb.cfg是設定檔，寫法可參考下文所寫格式</p>
<p><code>mongod --config &quot;C:\你的安裝路徑\bin\mongodb.cfg&quot; --serviceName &quot;MongoDB&quot; --serviceDisplayName &quot;MongoDB&quot; --install</code></p>
<p>在安裝的時候一起把設定檔讀入就不需要打前面那一大串了</p>
<p>讀取設定檔語法可以參照下面寫的 把設定路徑的部分改成讀取設定檔也行</p>
<p>筆者目前資料夾分布有以下(可自由設定)</p>
<pre><code>#資料庫存放的地方
C:/mongodb/data/db              
#備份存放的地方
C:/mongodb/data/backup        
#日誌檔存放的地方
C:/mongodb/data/log            
</code></pre>
<p>安裝成功使用以下可以看到服務啟動的提示，如果沒反應可能有地方打錯就重新安裝一次吧</p>
<h3 id="背景啟動指令："><a href="#背景啟動指令：" class="headerlink" title="背景啟動指令："></a>背景啟動指令：</h3><pre><code>net start MongoDB
</code></pre>
<h3 id="背景關閉指令："><a href="#背景關閉指令：" class="headerlink" title="背景關閉指令："></a>背景關閉指令：</h3><pre><code>net stop MongoDB
</code></pre>
<p>命令提示字元(Cmd)登入MongoDB：</p>
<p>若今天要用 asd1234帳號登入mongoDB存取mongodb，27012是當初設定的port</p>
<pre><code>mongo -u asd1234 -p zxc1234 --port 27012
</code></pre>
<p>以下指令可以在mongodb啟動時更改路徑</p>
<p>資料庫存放路徑：</p>
<p><code>mongod --dbpath=C:\mongodb\data</code>                       </p>
<p>Log檔案存放路徑：</p>
<p><code>mongod --logpath=C:\mongodb\log\mongod.log</code>    </p>
<p>讀取設定檔案路徑：</p>
<p><code>mongod --config &quot;C:\mongodb\bin\mongod.cfg&quot;</code>     </p>
<h2 id="mongod-cfg格式-注意縮排與空格-："><a href="#mongod-cfg格式-注意縮排與空格-：" class="headerlink" title="mongod.cfg格式(注意縮排與空格)："></a>mongod.cfg格式(注意縮排與空格)：</h2><pre><code>  storage:           #DB存放設定
      dbPath: C:\mongodb\data\db
      journal:    
        enabled: true
  systemLog:           #日誌檔存放設定
      destination: file
      logAppend: true 
      path: C:\mongodb\log\mongod.log
  security:
     authorization: enabled
  net:
     port: 27123        #綁定的PORT
     bindIp : 0.0.0.0   #允許遠端的所有IP
</code></pre>
<h1 id="MongoDB指令整理"><a href="#MongoDB指令整理" class="headerlink" title="MongoDB指令整理"></a>MongoDB指令整理</h1><p><strong>&lt;&gt; 、{} =&gt; 表示名稱，省略不打</strong></p>
<h2 id="資料庫操作"><a href="#資料庫操作" class="headerlink" title="資料庫操作"></a>資料庫操作</h2><pre><code>#顯示目前所在資料庫
db                                                
#檢視所有資料庫
show  dbs                                    
#檢視所有使用者
show  users                                 
#切換資料庫，原本沒有會自己新建一個，空DB不會顯示在檢視
use &lt;DB名稱&gt;                             
#檢視DB裡面的table，也能稱collection
show tables/collections                
#顯示table資料筆數
db.&lt;table名稱&gt;.count()                
</code></pre>
<h2 id="插入資料"><a href="#插入資料" class="headerlink" title="插入資料"></a>插入資料</h2><pre><code>#創建table，不過直接在插入資料時直接寫也行
db.createCollection(&quot;table名稱&quot;)  

#AND語法
db.&#123;collection名稱&#125;.find(&#123;&quot;欄位名稱&quot;:&quot;資料內容&quot;, &quot;欄位名稱&quot;:&quot;資料內容&quot;&#125;).pretty()
#OR語法
db.&#123;collection名稱&#125;.find(&#123;$or: [&#123;&quot;欄位名稱&quot;:&quot;資料內容&quot;&#125;, &#123;&quot;欄位名稱&quot;:&quot;資料內容&quot;&#125;]&#125;).pretty()
#兩者組合
db.&#123;collection名稱&#125;.find(&#123;&quot;欄位名稱&quot;:&#123;$gt:50&#125;,$or:[&#123;&quot;欄位名稱&quot;:&quot;資料內容&quot;&#125;,&#123;&quot;欄位名稱&quot;:&quot;資料內容&quot;&#125;]&#125;).pretty()
</code></pre>
<p>以下對 ({要插入的資料內容篩選條件}) 符號說明</p>
<pre><code>#等於50
&quot;by&quot;:&quot;50&quot;         
#小於50
&quot;欄位名稱&quot;:&#123;$lt:50&#125;    
#小於等於50    
&quot;欄位名稱&quot;:&#123;$lte:50&#125;  
#大於50
&quot;欄位名稱&quot;:&#123;$gt:50&#125;   
 #大於等於50
&quot;欄位名稱&quot;:&#123;$gte:50&#125; 
 #不等於
&quot;欄位名稱&quot;:&#123;$ne:50&#125;  
</code></pre>
<p>若碰上要一次插入多筆資料的情況</p>
<p>[  ]  → 多筆資料包起來，每筆資料逗號分隔</p>
<p>“  “  → 欄位名稱跟內容沒有也能插資料，通常是只有內容有 “ “ </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db.pets.insertMany([</span><br><span class="line">  &#123;</span><br><span class="line"></span><br><span class="line">    &quot;name&quot; : &quot;Daisy&quot;,</span><br><span class="line"></span><br><span class="line">    &quot;species&quot; : &quot;cat&quot;,</span><br><span class="line"></span><br><span class="line">    &quot;breed&quot; : &quot;calico&quot;</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;name&quot;:&quot;Bella&quot;,</span><br><span class="line"></span><br><span class="line">    &quot;species&quot;:&quot;dog&quot;,</span><br><span class="line"></span><br><span class="line">    &quot;breed&quot;:&quot;australian shepard&quot;</span><br><span class="line">  &#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure>
<h2 id="刪除資料庫"><a href="#刪除資料庫" class="headerlink" title="刪除資料庫"></a>刪除資料庫</h2><pre><code>#在DB底下操作才能刪除該資料庫
db.dropDatabase()   
#刪除table
db.&lt;table名稱&gt;.drop()   
#找到table有包含到該內容就刪除
db.&lt;table名稱&gt;.remove(&#123;欄位名稱 : 欄位內容,...&#125;)  
#全刪除
db.&lt;table名稱&gt;.remove()   
</code></pre>
<h2 id="搜尋資料庫內容"><a href="#搜尋資料庫內容" class="headerlink" title="搜尋資料庫內容"></a>搜尋資料庫內容</h2><pre><code>#回傳第一筆資料
db.&lt;table名稱&gt;.findOne()   
#回傳全部資料，pretty是讓顯示有間距好看
db.&lt;table名稱&gt;.find().pretty()  
</code></pre>
<h2 id="資料庫內容更新"><a href="#資料庫內容更新" class="headerlink" title="資料庫內容更新"></a>資料庫內容更新</h2><p><code>db.&lt;table名稱&gt;.update(&#123;name:&quot;MongoDB&quot;,其他欄位:欄位內容...&#125;,&#123;$set:&#123;name:&quot;Jack&quot;,其他欄位:欄位內容...&#125;&#125;,&#123;multi:true&#125;)</code></p>
<pre><code>&#123;name:&quot;MongoDB&quot;,其他欄位:欄位內容...&#125;：要更新的資料
&#123;$set:&#123;name:&quot;Jack&quot;,其他欄位:欄位內容...&#125;&#125;：從舊資料找符合內容的目標
&#123;multi:true&#125;：若要一次更新多筆要true
</code></pre>
<h2 id="資料庫備份"><a href="#資料庫備份" class="headerlink" title="資料庫備份"></a>資料庫備份</h2><p>指令如下</p>
<p><code>mongodump -h 127.0.0.1 --port 27120 -u root -p root1234 -d Number -o C:/mongodb/data/backup --authenticationDatabase admin</code></p>
<p>參數說明：</p>
<pre><code>#host,表示資料庫主機的IP位置或是電腦名稱
-h        
#user,登入的帳號
-u         
#password,登入的密碼
-p         
#指定port號
--port     
#database,備份資料庫的名稱
-d         
#collection,指定備份某一個Collection
-c         
 #output備份輸出的磁碟位置(Folder Path) 要備份在哪個磁碟要打不然會在奇怪地方
-o        
#開啟授權的資料庫需要加上否則無法使用
--authenticationDatabase admin 
</code></pre>
<p><strong>備份前最好先移動到 mongoDB 的  admin 資料庫下面</strong></p>
<p>使用以下指令<br>    #磁碟同步與上鎖<br>    db.runCommand({fsync:1,lock:1})<br>    #查看上鎖狀態 fsyncLock true 代表成功<br>    db.currentOp()<br>    #備份完成記得解鎖<br>    db.fsyncUnLock()</p>
<h2 id="資料庫還原"><a href="#資料庫還原" class="headerlink" title="資料庫還原"></a>資料庫還原</h2><p>指令如下</p>
<p><code>mongorestore -h 127.0.0.1 --port 27120 -d Number -u root -p root1234 --authenticationDatabase admin --dir C:/mongodb/data/backup/Number --drop</code></p>
<pre><code>#host,表示資料庫主機的IP位置或是電腦名稱
-h         
#user,登入的帳號
-u         
#password,登入的密碼
-p         
#指定port號
--port
#database,備份資料庫的名稱
-d        
#備份DB的磁碟位置(Folder Path) 要備份在哪個磁碟要打不然會在奇怪地方
-dir     
 #開啟授權的資料庫需要加上否則無法使用
--authenticationDatabase admin
#若Server有相同DB會先刪除再還原回去(因有相同名稱不能還原)，小心使用    
--drop  
</code></pre>
<h1 id="MongoDB遠端連線"><a href="#MongoDB遠端連線" class="headerlink" title="MongoDB遠端連線"></a>MongoDB遠端連線</h1><p><strong>沒有設定Auth沒辦法開放給其他電腦使用</strong></p>
<h2 id="設定Auth步驟"><a href="#設定Auth步驟" class="headerlink" title="設定Auth步驟"></a>設定Auth步驟</h2><ol>
<li><p>先移動到admin DB下操作</p>
</li>
<li><p>創建管理所有DB的管理帳號(最一開始需要的帳號)</p>
</li>
</ol>
<p> <code>db.createUser(&#123;user: &quot;asd1234&quot;,pwd: &quot;zxc1234&quot;,roles: [&#123; role: &quot;root&quot;, db: &quot;admin&quot; &#125;]&#125;)</code></p>
<ol start="3">
<li>再啟動MongoDB時開啟認證</li>
</ol>
<p> <code>mongod --auth </code></p>
<ol start="4">
<li><p>之後使用mongo進去就看不到所有資料庫狀態了</p>
<p> 一開始沒輸入帳號進去想登入管理者帳號就要移動到admin下使用語法：</p>
</li>
</ol>
<p> <code>db.auth(&quot;root&quot;, &quot;PASSWORD&quot;) </code></p>
<p>  在使用MongoDB的Shell開始就登入的語法：</p>
<p>  <strong>連接Port預設27017,遠端開放要改</strong></p>
<p>  <code>mongo -u 使用者帳號 -p 使用者密碼 --port 連接Port</code></p>
<ol start="5">
<li><p>能對不同資料庫增加不同使用者並設定權限</p>
<p> <code>db.createUser(&#123;user: &quot;使用者名稱&quot;,pwd: &quot;密碼&quot;,roles: [&#123; role: &quot;root/readWrite/read&quot;, db: &quot;資料庫名稱&quot; &#125;]&#125;)</code></p>
<ul>
<li>root #最大  </li>
<li>read #只能讀  </li>
<li>readWrite #能讀寫</li>
</ul>
</li>
</ol>
<p>補充用戶設定的相關指令<br>     #更新用戶權限<br>    db.updateUser(user, writeConcern)<br>    #在DB的 test 下創使用者<br>    db.createUser({ user:”asd1234”, pwd:”zxc1234”, roles:[“readWrite”, “dbAdmin”] })<br>    #遠端連線( / 為二選一)<br>    mongo [IP] / [database] -u username -p password</p>
<p>權限補充說明(部分)：</p>
<pre><code>dbAdmin
在指定DB中執行管理函數，如創建删除和查看資料表
userAdmin
可以在系統的users集合寫入，找指定DB創建删除和管理使用者
clusterAdmin
只在admin中可用，給使用者所有分片和複製集相關函數的管理權限
readAnyDatabase
只在admin中可用，給使用者所有DB的讀取權限
readWriteAnyDatabase
只在admin中可用，給使用者所有DB的讀寫權限 
</code></pre>
<h3 id="Auth可能會發生的問題"><a href="#Auth可能會發生的問題" class="headerlink" title="Auth可能會發生的問題"></a>Auth可能會發生的問題</h3><p><strong>若直接從設定檔開啟授權會導致無法遠端連線</strong></p>
<p><strong>要針對個別DB設置使用者再透過指令授權連線</strong></p>
<pre><code>#修改密碼
db.changeUserPassword(&quot;user123&quot;,&quot;password456&quot;)           
#刪除帳戶
db.dropUser(&quot;user123&quot;)   
</code></pre>
<h2 id="遠端電腦連線mongoDB"><a href="#遠端電腦連線mongoDB" class="headerlink" title="遠端電腦連線mongoDB"></a>遠端電腦連線mongoDB</h2><p>指令如下</p>
<pre><code>mongo &quot;mongodb://mongodb.test.com:連線的port&quot;
mongo --host mongodb.test.com:連線的port
mongo --host mongodb.test.com --port 連線的port
</code></pre>
<p>參數說明<br>    #連線地址(如mongodb.test.com ，也可以是 IP位置)<br>    –host <hostname></p>
<p>舉個例子<br>，使用者 root連線至admin DB使用</p>
<p>[  ]請依情況變化</p>
<p><code>mongo --host [192.168.xx.xxx] --port [27120] -u [&quot;root&quot;]  -p --authenticationDatabase [&quot;admin&quot;]</code></p>
<h1 id="MongoDB在-Centos-7環境操作"><a href="#MongoDB在-Centos-7環境操作" class="headerlink" title="MongoDB在 Centos 7環境操作"></a>MongoDB在 Centos 7環境操作</h1><p><strong>有時無法啟動檢查相關資料夾是否存在去看log檔案檢查是否為權限問題</strong></p>
<h2 id="更改Port很容易出現的問題"><a href="#更改Port很容易出現的問題" class="headerlink" title="更改Port很容易出現的問題"></a>更改Port很容易出現的問題</h2><pre><code>#如果不存在才新增沒有的資料夾
sudo mkdir /var/lib/mongodb                                
#設定資料夾權限  mongo為使用者名稱
sudo chown -R mongo:mongo /var/lib/mongodb   
#重設權限給mongod  改port 後就好了
sudo chown -R mongod:mongod /var/lib/mongo    
</code></pre>
<h2 id="沒設定授權用預設端口容易入侵被改內容"><a href="#沒設定授權用預設端口容易入侵被改內容" class="headerlink" title="沒設定授權用預設端口容易入侵被改內容"></a>沒設定授權用預設端口容易入侵被改內容</h2><pre><code>#啟動Mongodb
sudo service mongod start  /   systemctl start mongod.service    
#重啟Mongodb
sudo service mongod restart
#關閉Mongodb
sudo service mongod stop      
#查看目前狀態
systemctl status mongod.service 
</code></pre>
<p>如何正確關閉mongoDB<br>    1. mongo<br>    2. use admin<br>    3. db.shutdownServer()</p>
<p>如果以上指令還是無法解決就是重裝，重裝解決95%問題👌<br>    #卸載MongoDB<br>    sudo yum erase $(rpm -qa | grep mongodb-org)<br>    #刪除 log<br>    sudo rm -r /var/log/mongodb<br>    #對MongoDB設定檔修改<br>    nano  /etc/mongod.conf<br>     → 要開關帳號權限進去改完存檔重新啟動MongoDB</p>
<p>開放對外的端口方法：<br>    #查看防火牆狀態<br>    systemctl status firewalld<br>    #防火牆重載<br>    firewall-cmd –reload<br>    #開放PORT狀態  YES成功<br>    firewall-cmd –zone=public –query-port=27017/tcp<br>    #開放MongoDB PORT<br>    firewall-cmd –zone=public –add-port=27017/tcp –permanent   </p>
<h1 id="MongoDB-Cloud服務"><a href="#MongoDB-Cloud服務" class="headerlink" title="MongoDB  Cloud服務"></a>MongoDB  Cloud服務</h1><p>MongoDB Atlas 學術用512MB，官方近幾年在推的，我用過後覺得容量太小，有興趣可以參考</p>
<p>網誌在這 → <a href="https://www.mongodb.com/cloud/atlas/lp/try2?utm_source=google&utm_campaign=gs_apac_taiwan_search_brand_atlas_desktop&utm_term=mongodb%20cloud&utm_medium=cpc_paid_search&utm_ad=e&utm_ad_campaign_id=6498554090&gclid=CjwKCAjwgviIBhBkEiwA10D2j_c5k68hdbzBgb-OhwwLksgPAiIBf72pf4nfJskX6768fxCgt8OyIBoC7GIQAvD_BwE">MongoDB Atlas</a></p>
<h1 id="參考資料"><a href="#參考資料" class="headerlink" title="參考資料"></a>參考資料</h1><ul>
<li><a href="https://docs.mongodb.com/manual/tutorial/install-mongodb-on-red-hat/">官方Centos7安裝文件</a></li>
<li><a href="https://www.digitalocean.com/community/questions/mongo-cant-start-service">Mongo can not start service(權限問題)</a></li>
</ul>
]]></content>
      <categories>
        <category>技術筆記</category>
      </categories>
      <tags>
        <tag>MongoDB</tag>
        <tag>NoSQL</tag>
      </tags>
  </entry>
  <entry>
    <title>PHP 的堆結構：SplMaxHeap vs SplMinHeap 使用指南</title>
    <url>/2024/12/24/PHP%20%E7%9A%84%E5%A0%86%E7%B5%90%E6%A7%8B%EF%BC%9ASplMaxHeap%20vs%20SplMinHeap%20%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/</url>
    <content><![CDATA[<p>在資料處理上常常會需要取得資料的最大值，但每次都用陣列一次一次找難免費時費力，</p>
<p>在 Leetcode 解題過程中發現 PHP 有對應程式庫能解決此問題，</p>
<p>便想藉這次機會整理相關使用方式順便釐清一遍自己的思路。</p>
<span id="more"></span>

<h2 id="基礎概念"><a href="#基礎概念" class="headerlink" title="基礎概念"></a>基礎概念</h2><p>Heap，堆積，是一種二元樹狀的資料結構，其中又可分為 最大堆(MaxHeap) 和 最小堆(MinHeap)，</p>
<p>最大堆(MaxHeap) ：根節點(root)始終為最大數值，子節點永遠小於父節點</p>
<p>最小堆(MinHeap)：根節點(root)始終為最小數值，子節點永遠大於父節點</p>
<p>強大的PHP有實作這兩種Heap的函數功能，</p>
<p>MaxHeap / MinHeap 除了最後結果是 最大值 / 最小值外 其餘函數 皆 相同，</p>
<p>以下以 MaxHeap 功能分類做整理。</p>
<h2 id="函數功能"><a href="#函數功能" class="headerlink" title="函數功能"></a>函數功能</h2><p>列出實作上會使用的功能參考，</p>
<h3 id="初始宣告"><a href="#初始宣告" class="headerlink" title="初始宣告"></a>初始宣告</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$max_heap</span> = <span class="keyword">new</span> <span class="built_in">SplMaxHeap</span>();</span><br></pre></td></tr></table></figure>

<h3 id="插入資料：insert"><a href="#插入資料：insert" class="headerlink" title="插入資料：insert()"></a>插入資料：insert()</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$max_heap</span>-&gt;insert(<span class="number">2</span>);</span><br><span class="line"><span class="variable">$max_heap</span>-&gt;insert(<span class="number">4</span>);</span><br><span class="line"><span class="variable">$max_heap</span>-&gt;insert(<span class="number">6</span>);</span><br></pre></td></tr></table></figure>

<h3 id="計算資料數：count"><a href="#計算資料數：count" class="headerlink" title="計算資料數：count()"></a>計算資料數：count()</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$now_count</span> = <span class="variable">$max_heap</span>-&gt;count();</span><br><span class="line"><span class="comment">// $now_count = 3</span></span><br></pre></td></tr></table></figure>

<h3 id="取得所在位置：current"><a href="#取得所在位置：current" class="headerlink" title="取得所在位置：current()"></a>取得所在位置：current()</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$max_heap</span>-&gt;rewind(); <span class="comment">// 初始化指標，返回最上層</span></span><br><span class="line"><span class="variable">$now_position</span> = <span class="variable">$max_heap</span>-&gt;current(); <span class="comment">// 回傳 6</span></span><br><span class="line">-&gt; 少了呼叫指標步驟會回傳 <span class="literal">NULL</span></span><br></pre></td></tr></table></figure>

<h3 id="取最大值：top"><a href="#取最大值：top" class="headerlink" title="取最大值：top()"></a>取最大值：top()</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$curr_max</span> = <span class="variable">$max_heap</span>-&gt;top(); <span class="comment">// 回傳 6</span></span><br></pre></td></tr></table></figure>

<h3 id="取最大值並移除：extract"><a href="#取最大值並移除：extract" class="headerlink" title="取最大值並移除：extract()"></a>取最大值並移除：extract()</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$curr_max</span> = <span class="variable">$max_heap</span>-&gt;extract(); <span class="comment">// 回傳 6 並 移除資料</span></span><br><span class="line">-&gt; 若 Heap 中沒資料呼叫會返回錯誤</span><br></pre></td></tr></table></figure>

<h3 id="判斷資料存在：isEmpty"><a href="#判斷資料存在：isEmpty" class="headerlink" title="判斷資料存在：isEmpty()"></a>判斷資料存在：isEmpty()</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$curr_status</span> = <span class="variable">$max_heap</span>-&gt;isEmpty(); <span class="comment">// 不為空 返回 false</span></span><br></pre></td></tr></table></figure>

<h3 id="移動資料指針：next"><a href="#移動資料指針：next" class="headerlink" title="移動資料指針：next()"></a>移動資料指針：next()</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$max_heap</span>-&gt;next();</span><br><span class="line"><span class="variable">$now_position</span> = <span class="variable">$max_heap</span>-&gt;current(); <span class="comment">// 回傳 4</span></span><br></pre></td></tr></table></figure>

<p>能熟練掌握以上方法，那 SplMaxHeap 操作上就不會有太大問題了！</p>
<p>剩下就是需判斷專案何時該使用此功能的情況了。</p>
<h2 id="應用場景"><a href="#應用場景" class="headerlink" title="應用場景"></a>應用場景</h2><h3 id="各類排行榜"><a href="#各類排行榜" class="headerlink" title="各類排行榜"></a>各類排行榜</h3><p>每次插入資料 Heap 都會自動變更最大值，能更快速取得數組的排序。</p>
<p>以下就常見的取得最大值方式做 效能比較</p>
<table>
<thead>
<tr>
<th><strong>功能</strong></th>
<th><strong>時間複雜度</strong></th>
<th><strong>空間複雜度</strong></th>
<th><strong>應用</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>max()</strong></td>
<td>O(n)</td>
<td>O(1)</td>
<td>取得當下資料最大值做法</td>
</tr>
<tr>
<td><strong>sort()</strong></td>
<td>O(n log n)</td>
<td>O(n)</td>
<td>需排序資料陣列才會採用</td>
</tr>
<tr>
<td><strong>SplMaxHeap</strong></td>
<td>O(n log n)</td>
<td>O(n)</td>
<td>頻繁取得最大值效能較佳</td>
</tr>
</tbody></table>
<p>筆者有在 Leetcode 題目看過不少適用此方法的案例，</p>
<p>實務上反而沒什麼用到，畢竟是比較偏效能優化上的方法，</p>
<p>期許未來接觸到的專案能有使用到的機會吧！</p>
<h2 id="資料參考來源"><a href="#資料參考來源" class="headerlink" title="資料參考來源"></a>資料參考來源</h2><p><a href="https://www.php.net/docs.php">PHP: Hypertext Preprocessor</a></p>
]]></content>
      <categories>
        <category>技術筆記</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>Heap</tag>
      </tags>
  </entry>
  <entry>
    <title>PHP 陣列操作的 10 個實用技巧</title>
    <url>/2024/12/23/PHP%20%E9%99%A3%E5%88%97%E6%93%8D%E4%BD%9C%E7%9A%84%2010%20%E5%80%8B%E5%AF%A6%E7%94%A8%E6%8A%80%E5%B7%A7/</url>
    <content><![CDATA[<p>整理了些 PHP開發 在 工作或解題上可能會用到的實用函數，</p>
<p>依需求可大致區分為以下類別，</p>
<span id="more"></span>

<h2 id="是否存在特定資料"><a href="#是否存在特定資料" class="headerlink" title="是否存在特定資料"></a>是否存在特定資料</h2><p>二維陣列 使用 <strong>array_key_exists()</strong></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$example</span> = [<span class="string">&quot;zh&quot;</span>=&gt;<span class="number">0</span>,<span class="string">&quot;en&quot;</span>=&gt;<span class="number">1</span>];</span><br><span class="line"><span class="variable">$check</span> = array_key_exists(<span class="string">&quot;zh&quot;</span>,<span class="variable">$example</span>);</span><br><span class="line">-&gt; 存在 <span class="literal">true</span> , 反之 <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<p>一維陣列 使用 <strong>in_array()</strong></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$example</span> = [<span class="string">&quot;zh&quot;</span>,<span class="string">&quot;en&quot;</span>];</span><br><span class="line"><span class="variable">$check</span> = in_array(<span class="string">&quot;zh&quot;</span>,<span class="variable">$example</span>,<span class="literal">true</span>);</span><br><span class="line">-&gt; 存在 <span class="literal">true</span> , 反之 <span class="literal">false</span></span><br><span class="line">-&gt;加上第三參數(選填)會加上 變數型態 判斷</span><br></pre></td></tr></table></figure>

<h2 id="提取特定欄位資料"><a href="#提取特定欄位資料" class="headerlink" title="提取特定欄位資料"></a>提取特定欄位資料</h2><p>使用 <strong>array_column()</strong></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$example</span> = [</span><br><span class="line">		<span class="string">&quot;zh&quot;</span>=&gt;[</span><br><span class="line">			<span class="string">&quot;id&quot;</span> =&gt; <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span>=&gt;<span class="string">&quot;中文&quot;</span>,</span><br><span class="line">			<span class="string">&quot;code_count&quot;</span>=&gt;<span class="number">10</span>,</span><br><span class="line">		],</span><br><span class="line">		<span class="string">&quot;en&quot;</span>=&gt;[</span><br><span class="line">			<span class="string">&quot;id&quot;</span> =&gt; <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span>=&gt;<span class="string">&quot;英文&quot;</span>,</span><br><span class="line">			<span class="string">&quot;code_count&quot;</span>=&gt;<span class="number">25</span>,</span><br><span class="line">		],</span><br><span class="line">	];</span><br><span class="line"><span class="variable">$result</span> = array_column(<span class="variable">$example</span> ,<span class="string">&quot;code_count&quot;</span>);</span><br><span class="line">-&gt; 轉換成 <span class="variable">$result</span> = [<span class="number">10</span>,<span class="number">25</span>]</span><br><span class="line"></span><br><span class="line"><span class="variable">$result</span> = array_column(<span class="variable">$example</span> ,<span class="string">&quot;code_count&quot;</span>,<span class="string">&quot;id&quot;</span>);</span><br><span class="line">-&gt; 設置 id欄位當索引 轉換成 <span class="variable">$result</span> = [ [<span class="number">1</span>]=&gt;<span class="number">10</span>, [<span class="number">2</span>]=&gt;<span class="number">25</span>]</span><br></pre></td></tr></table></figure>

<h2 id="索引跟資料翻轉顯示"><a href="#索引跟資料翻轉顯示" class="headerlink" title="索引跟資料翻轉顯示"></a>索引跟資料翻轉顯示</h2><p>使用 <strong>array_flip()</strong></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$example</span> = [<span class="string">&quot;zh&quot;</span>,<span class="string">&quot;en&quot;</span>];</span><br><span class="line"><span class="variable">$result</span> = array_flip(<span class="variable">$example</span>);</span><br><span class="line">-&gt; 轉換成 <span class="variable">$result</span> = [ [<span class="string">&quot;zh&quot;</span>]=&gt;<span class="number">0</span>, [<span class="string">&quot;en&quot;</span>]=&gt;<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="variable">$example</span> = [<span class="string">&quot;zh&quot;</span>=&gt;<span class="number">2</span>,<span class="string">&quot;cn&quot;</span>=&gt;<span class="number">2</span>,<span class="string">&quot;en&quot;</span>=&gt;<span class="number">3</span>];</span><br><span class="line"><span class="variable">$result</span> = array_flip(<span class="variable">$example</span>);</span><br><span class="line">-&gt; 存在相同value取後，轉換成 <span class="variable">$result</span> = [ [<span class="number">2</span>]=&gt;<span class="string">&quot;cn&quot;</span>, [<span class="number">3</span>]=&gt;<span class="string">&quot;en&quot;</span>]</span><br></pre></td></tr></table></figure>

<h2 id="計算資料存在數量"><a href="#計算資料存在數量" class="headerlink" title="計算資料存在數量"></a>計算資料存在數量</h2><p>使用 <strong>array_count_values()</strong></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$example</span> = [<span class="string">&quot;zh&quot;</span>,<span class="number">2</span>,<span class="string">&quot;cn&quot;</span>,<span class="number">2</span>,<span class="string">&quot;en&quot;</span>,<span class="number">3</span>,<span class="string">&quot;cn&quot;</span>];</span><br><span class="line"><span class="variable">$result</span> = array_count_values(<span class="keyword">array</span>);</span><br><span class="line">-&gt; 轉換成 <span class="variable">$result</span> = [ </span><br><span class="line">			[<span class="string">&quot;zh&quot;</span>]=&gt; <span class="number">1</span>, </span><br><span class="line">			[<span class="number">2</span>]=&gt; <span class="number">2</span>,</span><br><span class="line">			[<span class="string">&quot;cn&quot;</span>]=&gt; <span class="number">2</span>,</span><br><span class="line">			[<span class="string">&quot;en&quot;</span>]=&gt; <span class="number">1</span>,</span><br><span class="line">			[<span class="number">3</span>]=&gt; <span class="number">1</span>,</span><br><span class="line">	]</span><br></pre></td></tr></table></figure>

<h2 id="填充多個預設值"><a href="#填充多個預設值" class="headerlink" title="填充多個預設值"></a>填充多個預設值</h2><p>使用 <strong>array_fill()</strong></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="variable">$exmaple</span> = array_fill(<span class="number">0</span>, <span class="number">5</span>, <span class="string">&quot;fill&quot;</span>);</span><br><span class="line">-&gt; 從 <span class="number">0</span> 開始產生 <span class="number">5</span> 個值， <span class="variable">$result</span> = [<span class="string">&quot;fill&quot;</span>,<span class="string">&quot;fill&quot;</span>,<span class="string">&quot;fill&quot;</span>,<span class="string">&quot;fill&quot;</span>,<span class="string">&quot;fill&quot;</span>]</span><br></pre></td></tr></table></figure>

<h2 id="特定位置移除-拼接數值"><a href="#特定位置移除-拼接數值" class="headerlink" title="特定位置移除/拼接數值"></a><strong>特定位置移除/拼接數值</strong></h2><p>名稱上容易混淆的就放一起講</p>
<p>**array_splice(拼接)**，移除陣列特定位置數值 並用 其他數值 取代</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">array_splice(陣列,偏移,移除長度(選填),取代數值(選填))</span><br><span class="line"></span><br><span class="line"><span class="variable">$example</span> = [<span class="string">&quot;zh&quot;</span>,<span class="string">&quot;en&quot;</span>,<span class="string">&quot;cn&quot;</span>,<span class="string">&quot;vn&quot;</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable">$result</span> = array_splice(<span class="variable">$example</span>,<span class="number">2</span>);</span><br><span class="line">-&gt; 不存在移除長度時 偏移= 取得個數 ， <span class="variable">$result</span> = [<span class="string">&quot;zh&quot;</span>,<span class="string">&quot;en&quot;</span>] </span><br><span class="line"></span><br><span class="line"><span class="variable">$result</span> = array_splice(<span class="variable">$example</span>,<span class="number">2</span>,<span class="number">1</span>);</span><br><span class="line">-&gt; 從 位置<span class="number">2</span> 的開始移除 <span class="number">1</span> 個數值， <span class="variable">$result</span> = [<span class="string">&quot;zh&quot;</span>,<span class="string">&quot;en&quot;</span>,<span class="string">&quot;vn&quot;</span>] </span><br><span class="line"></span><br><span class="line"><span class="variable">$result</span> = array_splice(<span class="variable">$example</span>,-<span class="number">2</span>,<span class="number">2</span>);</span><br><span class="line">-&gt; 從 倒數位置<span class="number">2</span> 的開始移除 <span class="number">2</span> 個數值， <span class="variable">$result</span> = [<span class="string">&quot;zh&quot;</span>,<span class="string">&quot;en&quot;</span>] </span><br><span class="line"></span><br><span class="line"><span class="variable">$result</span> = array_splice(<span class="variable">$example</span>,<span class="number">2</span>,count(<span class="variable">$example</span>),<span class="string">&quot;remove&quot;</span>);</span><br><span class="line">-&gt; 從 位置<span class="number">2</span> 的開始移除數值(超過可用數=全砍)並替換字串  <span class="variable">$result</span> = [<span class="string">&quot;zh&quot;</span>,<span class="string">&quot;en&quot;</span>,<span class="string">&quot;remove&quot;</span>] </span><br><span class="line"></span><br><span class="line"><span class="variable">$result</span> = array_splice(<span class="variable">$example</span>,<span class="number">2</span>,count(<span class="variable">$example</span>),[<span class="string">&quot;remove&quot;</span>,<span class="string">&quot;remove2&quot;</span>]);</span><br><span class="line">-&gt; 從 位置<span class="number">2</span> 的開始移除數值並替換字串  <span class="variable">$result</span> = [<span class="string">&quot;zh&quot;</span>,<span class="string">&quot;en&quot;</span>,<span class="string">&quot;remove&quot;</span>,<span class="string">&quot;remove2&quot;</span>] </span><br></pre></td></tr></table></figure>

<p>**array_slice(移除)**，切除陣列特定位置數值</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">array_slice(陣列,偏移,移除長度(選填),是否保留原本陣列key(選填))</span><br><span class="line"></span><br><span class="line"><span class="variable">$example</span> = [<span class="string">&quot;zh&quot;</span>,<span class="string">&quot;en&quot;</span>,<span class="string">&quot;cn&quot;</span>,<span class="string">&quot;vn&quot;</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable">$result</span> = array_slice(<span class="variable">$example</span>,<span class="number">2</span>);</span><br><span class="line">-&gt; 不存在移除長度時 偏移= 位置<span class="number">0</span> 開始的移除個數， <span class="variable">$result</span> = [<span class="string">&quot;cn&quot;</span>,<span class="string">&quot;vn&quot;</span>] </span><br><span class="line"></span><br><span class="line"><span class="variable">$result</span> = array_slice(<span class="variable">$example</span>,-<span class="number">2</span>,<span class="number">1</span>);</span><br><span class="line">-&gt; 在 倒數第<span class="number">2</span>位置 切除 <span class="number">1</span> 個數值， <span class="variable">$result</span> = [<span class="string">&quot;cn&quot;</span>] </span><br><span class="line"></span><br><span class="line"><span class="variable">$result</span> = array_slice(<span class="variable">$example</span>, <span class="number">0</span>,-<span class="number">2</span>);</span><br><span class="line">-&gt; 在 位置<span class="number">0</span> 開始，切除倒數 <span class="number">2</span> 個數值， <span class="variable">$result</span> = [<span class="string">&quot;zh&quot;</span>,<span class="string">&quot;en&quot;</span>] </span><br><span class="line"></span><br><span class="line"><span class="variable">$result</span> = array_slice(<span class="variable">$example</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="literal">true</span>);</span><br><span class="line">-&gt; 在 第<span class="number">2</span>位置 切除 <span class="number">2</span> 個數值，保留原先索引， <span class="variable">$result</span> = [[<span class="number">2</span>]=&gt;<span class="string">&quot;cn&quot;</span>,[<span class="number">3</span>]=&gt;<span class="string">&quot;vn&quot;</span>] </span><br></pre></td></tr></table></figure>

<h2 id="物件資料轉陣列"><a href="#物件資料轉陣列" class="headerlink" title="物件資料轉陣列"></a>物件資料轉陣列</h2><p>使用 <strong>json_decode()</strong></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$example</span> = <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">		&quot;id&quot;:&quot;1&quot;,</span></span><br><span class="line"><span class="string">		&quot;name&quot;:&quot;English&quot;,</span></span><br><span class="line"><span class="string">		&quot;status&quot;:&quot;1&quot;</span></span><br><span class="line"><span class="string">	&#125;&#x27;</span>;</span><br><span class="line"><span class="variable">$result</span> = json_decode(<span class="variable">$example</span>,<span class="literal">true</span>);</span><br><span class="line">-&gt; <span class="variable">$result</span> = [<span class="string">&quot;id&quot;</span>=&gt;<span class="string">&quot;1&quot;</span>,<span class="string">&quot;name&quot;</span>=&gt;<span class="string">&quot;English&quot;</span>,<span class="string">&quot;status&quot;</span>=&gt;<span class="string">&quot;1&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// json_encode($arr) 陣列轉物件資料</span></span><br></pre></td></tr></table></figure>

<h2 id="合併多個陣列資料"><a href="#合併多個陣列資料" class="headerlink" title="合併多個陣列資料"></a>合併多個陣列資料</h2><p>只有兩個，使用 <strong>array_combine()</strong></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$example</span> = [<span class="string">&quot;zh&quot;</span>,<span class="string">&quot;en&quot;</span>,<span class="string">&quot;cn&quot;</span>,<span class="string">&quot;vn&quot;</span>];</span><br><span class="line"><span class="variable">$example_2</span> = [<span class="string">&quot;1&quot;</span>,<span class="number">2</span>,<span class="number">3.5</span>,<span class="literal">true</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable">$result</span> = array_combine(<span class="variable">$example</span>,<span class="variable">$example_2</span>);</span><br><span class="line">-&gt; 前陣列當key後陣列當value  <span class="variable">$result</span> = [<span class="string">&quot;zh&quot;</span>=&gt;<span class="string">&quot;1&quot;</span>,<span class="string">&quot;en&quot;</span>=&gt;<span class="number">2</span>,<span class="string">&quot;cn&quot;</span>=&gt;<span class="number">3.5</span>,<span class="string">&quot;vn&quot;</span>=&gt;<span class="literal">true</span>]</span><br></pre></td></tr></table></figure>

<p>多個陣列，使用 <strong>array_merge()</strong></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$example</span> = [<span class="string">&quot;zh&quot;</span>=&gt;<span class="string">&quot;tw&quot;</span>,<span class="string">&quot;en&quot;</span>,<span class="string">&quot;cn&quot;</span>,<span class="string">&quot;vn&quot;</span>];</span><br><span class="line"><span class="variable">$example_2</span> = [<span class="string">&quot;1&quot;</span>,<span class="number">2</span>,<span class="number">3.5</span>,<span class="literal">true</span>,<span class="string">&quot;name&quot;</span>=&gt;<span class="string">&quot;中文&quot;</span>];</span><br><span class="line"><span class="variable">$example_3</span> = [<span class="number">6</span>];</span><br><span class="line"><span class="variable">$result</span> = array_merge(<span class="variable">$example</span>,<span class="variable">$example_2</span>,<span class="variable">$example_3</span>);</span><br><span class="line">-&gt; <span class="variable">$result</span> = [</span><br><span class="line">		[<span class="string">&quot;zh&quot;</span>] =&gt;<span class="string">&quot;tw&quot;</span>,</span><br><span class="line">		   [<span class="number">0</span>] =&gt; <span class="string">&quot;en&quot;</span>,</span><br><span class="line">		   [<span class="number">1</span>] =&gt; <span class="string">&quot;cn&quot;</span>,</span><br><span class="line">		   [<span class="number">2</span>] =&gt; <span class="string">&quot;vn&quot;</span>,</span><br><span class="line">		   [<span class="number">3</span>] =&gt; <span class="string">&quot;1&quot;</span>,</span><br><span class="line">		   [<span class="number">4</span>] =&gt; <span class="number">2</span>,</span><br><span class="line">		   [<span class="number">5</span>] =&gt; <span class="number">3.5</span>, </span><br><span class="line">		   [<span class="number">6</span>] =&gt; <span class="literal">true</span>,</span><br><span class="line">	[<span class="string">&quot;name&quot;</span>] =&gt; <span class="string">&quot;中文&quot;</span>,</span><br><span class="line">		   [<span class="number">7</span>] =&gt; <span class="number">6</span></span><br><span class="line">	]</span><br></pre></td></tr></table></figure>

<h2 id="取得索引或資料的數值"><a href="#取得索引或資料的數值" class="headerlink" title="取得索引或資料的數值"></a>取得索引或資料的數值</h2><p>要取得 資料，使用 <strong>array_values()</strong></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$example</span> = [<span class="string">&quot;zh&quot;</span>=&gt;<span class="string">&quot;tw&quot;</span>,<span class="string">&quot;en&quot;</span>=&gt;<span class="number">2</span>,<span class="string">&quot;cn&quot;</span>=&gt;<span class="number">3.3</span>,<span class="string">&quot;vn&quot;</span>=&gt;<span class="literal">false</span>];</span><br><span class="line"><span class="variable">$result</span> = array_values(<span class="variable">$example</span>);</span><br><span class="line">-&gt; <span class="variable">$result</span> = [<span class="string">&quot;tw&quot;</span>,<span class="number">2</span>,<span class="number">3.3</span>,<span class="literal">false</span>]</span><br></pre></td></tr></table></figure>

<p>要取得 索引，使用 <strong>array_keys()</strong></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$example</span> = [<span class="string">&quot;zh&quot;</span>=&gt;<span class="string">&quot;tw&quot;</span>,<span class="string">&quot;en&quot;</span>=&gt;<span class="number">2</span>,<span class="string">&quot;cn&quot;</span>=&gt;<span class="number">3.3</span>,<span class="string">&quot;vn&quot;</span>=&gt;<span class="literal">false</span>];</span><br><span class="line"><span class="variable">$result</span> = array_keys(<span class="variable">$example</span>);</span><br><span class="line">-&gt; <span class="variable">$result</span> = [<span class="string">&quot;zh&quot;</span>,<span class="string">&quot;en&quot;</span>,<span class="string">&quot;cn&quot;</span>,<span class="string">&quot;vn&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="variable">$example</span> = [<span class="string">&quot;zh&quot;</span>,<span class="string">&quot;en&quot;</span>,<span class="string">&quot;cn&quot;</span>,<span class="string">&quot;vn&quot;</span>,<span class="string">&quot;en&quot;</span>];</span><br><span class="line"><span class="variable">$result</span> = array_keys(<span class="variable">$example</span>,<span class="string">&quot;en&quot;</span>);</span><br><span class="line">-&gt; 一維陣列使用返回陣列位置 <span class="variable">$result</span> =[<span class="number">1</span>,<span class="number">4</span>]</span><br></pre></td></tr></table></figure>

<h2 id="處理多次資料功能循環"><a href="#處理多次資料功能循環" class="headerlink" title="處理多次資料功能循環"></a>處理多次資料功能循環</h2><p>多個陣列，使用 <strong>array_map()</strong></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 沒宣告函數功能</span></span><br><span class="line"><span class="variable">$example</span> = [<span class="string">&quot;zh&quot;</span>,<span class="string">&quot;en&quot;</span>,<span class="string">&quot;cn&quot;</span>,<span class="string">&quot;vn&quot;</span>];</span><br><span class="line"><span class="variable">$example_2</span> = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>];</span><br><span class="line"><span class="variable">$result</span> = array_map(<span class="literal">null</span>,<span class="variable">$example</span>,<span class="variable">$example_2</span>);</span><br><span class="line">-&gt; <span class="variable">$result</span> =[</span><br><span class="line">		[<span class="number">0</span>]=&gt; [</span><br><span class="line">			[<span class="number">0</span>]=&gt;<span class="string">&quot;zh&quot;</span>, </span><br><span class="line">			[<span class="number">1</span>]=&gt; <span class="number">1</span> </span><br><span class="line">	     ],</span><br><span class="line">		 [<span class="number">1</span>]=&gt;[ </span><br><span class="line">			[<span class="number">0</span>]=&gt;<span class="string">&quot;en&quot;</span>,</span><br><span class="line">			[<span class="number">1</span>]=&gt; <span class="number">2</span> </span><br><span class="line">		 ], </span><br><span class="line">		 [<span class="number">2</span>]=&gt; [ </span><br><span class="line">			[<span class="number">0</span>]=&gt; <span class="string">&quot;cn&quot;</span>, </span><br><span class="line">			[<span class="number">1</span>]=&gt; <span class="number">3</span> </span><br><span class="line">		 ], </span><br><span class="line">		 [<span class="number">3</span>]=&gt; [ </span><br><span class="line">			[<span class="number">0</span>]=&gt; <span class="string">&quot;vn&quot;</span>, </span><br><span class="line">			[<span class="number">1</span>]=&gt; <span class="number">4</span> </span><br><span class="line">		 ]</span><br><span class="line">	]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 有宣告函數功能</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">strick</span>(<span class="params"><span class="variable">$n</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> (<span class="variable">$n</span> .<span class="string">&quot; ^ &quot;</span>. <span class="variable">$n</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$example</span> = [<span class="string">&quot;zh&quot;</span>,<span class="string">&quot;en&quot;</span>,<span class="string">&quot;cn&quot;</span>,<span class="string">&quot;vn&quot;</span>];</span><br><span class="line"><span class="variable">$result</span> = array_map(<span class="string">&quot;strick&quot;</span>,<span class="variable">$example</span>);</span><br><span class="line">-&gt; <span class="variable">$result</span> =[<span class="string">&quot;zh ^ zh&quot;</span>,<span class="string">&quot;en ^ en&quot;</span>,<span class="string">&quot;cn ^ cn&quot;</span>,<span class="string">&quot;vn ^ vn&quot;</span>]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>陣列相關的函數還有很多，這邊筆者只是先列出較常使用的提供參考。</p>
<h2 id="處理後端資料轉陣列-JQuery"><a href="#處理後端資料轉陣列-JQuery" class="headerlink" title="處理後端資料轉陣列(JQuery)"></a>處理後端資料轉陣列(JQuery)</h2><p>這邊不算 PHP的語法，是筆者在過往專案中有使用的部分，</p>
<p>後端通常情況下回傳資料都會是 json 格式，前端轉陣列使用上的參考。</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> response =&#123;</span><br><span class="line">	<span class="string">&quot;type&quot;</span>:<span class="string">&quot;success&quot;</span>,</span><br><span class="line">	<span class="string">&quot;data&quot;</span>: </span><br><span class="line">		<span class="string">&quot;1&quot;</span>:&#123;</span><br><span class="line">			<span class="string">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;code&quot;</span>: <span class="string">&quot;zh_tw&quot;</span>,</span><br><span class="line">			<span class="string">&quot;count&quot;</span>: <span class="number">25</span> </span><br><span class="line">		&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> data_result = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.values() <span class="comment">//傳入物件，直接轉陣列</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.values(response.data).forEach(<span class="function">(<span class="params">item</span>)=&gt;</span>&#123;</span><br><span class="line">	data_result.push(item[<span class="string">&#x27;code&#x27;</span>]);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">-&gt; data_result = [<span class="string">&quot;zh_tw&quot;</span>];</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.keys()  <span class="comment">//傳入物件，將其 key 值轉陣列</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.keys(response.data).forEach(<span class="function">(<span class="params">item</span>)=&gt;</span>&#123;</span><br><span class="line">	data_result.push(item);</span><br><span class="line">&#125;);</span><br><span class="line">-&gt; data_result = [<span class="string">&quot;1&quot;</span>];</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.entries() <span class="comment">//傳入物件，將 key 與 value 轉陣列</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.entries(response.data).forEach(<span class="function">(<span class="params">item</span>)=&gt;</span>&#123;</span><br><span class="line">	data_result.push(item);</span><br><span class="line">&#125;);</span><br><span class="line">-&gt; data_result = [ [<span class="string">&quot;1&quot;</span>, &#123; <span class="string">&quot;id&quot;</span>: <span class="number">1</span>, <span class="string">&quot;code&quot;</span>: <span class="string">&quot;zh_tw&quot;</span>, <span class="string">&quot;count&quot;</span>: <span class="number">25</span> &#125;]];</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="資料參考來源"><a href="#資料參考來源" class="headerlink" title="資料參考來源"></a>資料參考來源</h2><p><a href="https://www.php.net/docs.php">PHP: Hypertext Preprocessor</a></p>
]]></content>
      <categories>
        <category>技術筆記</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>Array</tag>
      </tags>
  </entry>
  <entry>
    <title>Python地址轉換地圖經緯度</title>
    <url>/2021/08/23/Python%E5%9C%B0%E5%9D%80%E8%BD%89%E6%8F%9B%E5%9C%B0%E5%9C%96%E7%B6%93%E7%B7%AF%E5%BA%A6/</url>
    <content><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>在實作地圖的時候多少會遇到資料只有地址的情況</p>
<p>以最常見的Google map來說，要標記一個地點就需要經緯度</p>
<p>當然Google本身也有提出對應的API → Geocoding(地理編碼)服務</p>
<p>簡單來說能直接把地址經查詢後轉經緯度回傳，當回傳次數一多就會有收費的問題了…</p>
<p><strong>那這時候需要處理大量資料的工程師怎麼辦呢?</strong></p>
<span id="more"></span>

<ol>
<li>台灣內政部有提供一個全國門牌地址地位服務<br>(<a href="https://www.tgos.tw/TGOS/Web/Address/TGOS_Address.aspx">門牌地址地位服務</a>)</li>
</ol>
<p>  <strong><font color = "dd0000">該服務要申請會員，每日上限10000筆 </font></strong></p>
<p>  只要選擇篩選的情況(接受模糊地段等)，將資料整理成規定格式上傳後，處理完後會寄到信箱(約一小時左右)</p>
<p>  就我嘗試過的情況來說，太嚴格幾乎是抓不到東西，沒怎麼設定可能地址對照出來是別的街道…</p>
<ol start="2">
<li><p>Python 網頁爬蟲，透過電腦控制網頁開啟執行重複的動作取得經緯度，也是本文要說的重點</p>
<p> 在資訊如此發達的現代，網路上爬蟲教學文多到不行，我也試著留下作法讓後人可以少走冤枉路</p>
</li>
</ol>
<hr>
<h1 id="執行環境"><a href="#執行環境" class="headerlink" title="執行環境"></a>執行環境</h1><p>以下程式碼在 Python3.6.8 可以使用，3.4以上的應該都適用</p>
<p>若電腦沒裝python，請去<a href="https://www.python.org/">python官網</a></p>
<ol>
<li>Downloads</li>
<li>All releases</li>
<li>選擇適合版本</li>
<li>直接安裝到底</li>
</ol>
<p>終端機(cmd)執行以下指令可以看python版本</p>
<pre><code>python -V
</code></pre>
<p>安裝Python自動化模組(<a href="https://selenium-python.readthedocs.io/locating-elements.html">官方文件</a>)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pip install selenium</span><br></pre></td></tr></table></figure>
<p>當然要開什麼瀏覽器需要去抓那瀏覽器對應的驅動程式(**Driver.exe)</p>
<p>以Google瀏覽器為例(<a href="https://sites.google.com/a/chromium.org/chromedriver/downloads">驅動程式下載</a>)，選擇自己Chrome的版本下載</p>
<p>怎麼看自己的Chrome版本</p>
<ol>
<li>點選網頁右上角頭像旁邊三個點</li>
<li>選擇設定</li>
<li>關於Google</li>
</ol>
<p><strong>下載完記得跟Python程式放在同一資料夾</strong></p>
<p>安裝偽裝用戶代理模組</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pip install fake_useragent</span><br></pre></td></tr></table></figure>
<p>爬蟲若是爬得過於頻繁就會被網頁偵測到，這時候只能在開啟的網頁下點功夫，舉例來說，正常開啟網頁做操作會有個請求的表頭，下面這段就是正常打開做請求的時候會送出的Useragent(用戶代理)</p>
<p><code>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.159 Safari/537.36</code></p>
<p>會顯示用戶作業系統、瀏覽器版本等等的資訊，有些網頁擋爬蟲是看這個(部分是看IP請求次數)</p>
<p>若重複的代理一直送請求容易很快就被擋，這地方做點偽裝延後被擋的時間</p>
<h1 id="Python程式"><a href="#Python程式" class="headerlink" title="Python程式"></a>Python程式</h1><p>接著就是選定要爬蟲的網頁，以<a href="https://www.map.com.tw/">台灣電子地圖服務網</a>為例子</p>
<p>以下程式碼會依 <strong>功能</strong> 分部分做解說</p>
<h2 id="網頁自動化"><a href="#網頁自動化" class="headerlink" title="網頁自動化"></a>網頁自動化</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">chrome_options = webdriver.ChromeOptions() </span><br><span class="line">browser = webdriver.Chrome(options=chrome_options) <span class="comment">#載入瀏覽器設定 </span></span><br><span class="line">targetUrl = <span class="string">&#x27;https://www.map.com.tw/&#x27;</span></span><br><span class="line">browser.get(targetUrl)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>上面程式碼執行後會開啟目標網頁，不做任何動作</p>
<p>瀏覽器此時會有一則提示寫著：目前被自動化程式控制</p>
<p>另外開啟的瀏覽器也有設定可以調整，以下提供幾個參考</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> fake_useragent <span class="keyword">import</span> UserAgent</span><br><span class="line"></span><br><span class="line"><span class="comment">#禁用瀏覽器彈窗設定</span></span><br><span class="line">prefs = &#123;</span><br><span class="line">    <span class="string">&#x27;profile.default_content_setting_values&#x27;</span>:</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&#x27;notifications&#x27;</span>: <span class="number">2</span></span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">ua = UserAgent()</span><br><span class="line"></span><br><span class="line">chrome_options = webdriver.ChromeOptions()</span><br><span class="line"></span><br><span class="line"><span class="comment">#不開視窗</span></span><br><span class="line">chrome_options.add_argument(<span class="string">&quot;--headless&quot;</span>)</span><br><span class="line"><span class="comment">#關閉GPU優化</span></span><br><span class="line">chrome_options.add_argument(<span class="string">&quot;--disable-gpu&quot;</span>)</span><br><span class="line"><span class="comment">#不載圖片</span></span><br><span class="line">chrome_options.add_argument(<span class="string">&#x27;blink-settings=imagesEnabled=false&#x27;</span>) </span><br><span class="line"><span class="comment">#使用者代理更換</span></span><br><span class="line">chrome_options.add_argument(<span class="string">&quot;user-agent=&#123;&#125;&quot;</span>.<span class="built_in">format</span>(ua.random))</span><br><span class="line"> <span class="comment">#隱藏打印日誌及自動化提示</span></span><br><span class="line">chrome_options.add_experimental_option(<span class="string">&quot;excludeSwitches&quot;</span>, [<span class="string">&quot;enable-logging&quot;</span>,<span class="string">&quot;enable-automation&quot;</span>])</span><br><span class="line"><span class="comment">#禁用瀏覽器彈窗</span></span><br><span class="line">chrome_options.add_experimental_option(<span class="string">&#x27;prefs&#x27;</span>,prefs)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>接著說明模組基本操作的方式，由於該模組是模擬人在網頁上的操作，只要網頁上有的東西都能抓</p>
<p>提供以下方式抓取網頁元素</p>
<pre><code>find_element_by_id
find_element_by_name
find_element_by_xpath                 
find_element_by_link_text
find_element_by_partial_link_text
find_element_by_tag_name
find_element_by_class_name
find_element_by_css_selector
</code></pre>
<p>有網頁開發基礎的應該不陌生，網頁元素都會有一些屬性存在</p>
<p>例如我要在台灣電子地圖上找到搜尋框，那我程式碼基於上面基礎可以再加上</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">addr = <span class="string">&#x27;臺北市中正區延平南路96號&#x27;</span></span><br><span class="line">search = browser.find_element_by_id(<span class="string">&#x27;searchWord&#x27;</span>) <span class="comment">#找到網頁上id 相等的元素</span></span><br><span class="line">search.clear()    								<span class="comment">#清除輸入框預設值</span></span><br><span class="line">search.send_keys(addr)							<span class="comment">#送出輸入值</span></span><br></pre></td></tr></table></figure>
<p>這程式會使網頁自動輸入地址並送出</p>
<p>不知道怎麼看網頁名稱的可以按下F12，選擇想看元素的位置就會右邊原始碼部分就會亮起</p>
<p>如果要用xpath定位參考下圖所示，複製到的就是網頁元素的XPATH<br><img src="/images/python_browser_1.png" alt="網頁爬蟲說明-1"></p>
<p>其他抓取元素的資訊一樣透過這方法來看，會了這個之後基本上就是熟悉語法的問題了</p>
<p>熟悉操作流程後來整理一下網頁的動作需求</p>
<ol>
<li>Python開啟網頁</li>
<li>在地圖搜尋框輸入特定地址後送出</li>
<li>找到位置後會出現該地址的資訊</li>
<li>點選座標的按鈕後網頁會顯示該地點經緯度</li>
<li>取得網頁顯示的經緯度後回傳</li>
<li>Python關閉網頁</li>
</ol>
<p>整理好需求後程式會長這樣，把流程寫成一個Python函式，地址在呼叫的時候給</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_coordinate</span>(<span class="params">addr</span>):</span></span><br><span class="line">  chrome_options = webdriver.ChromeOptions() </span><br><span class="line">  browser = webdriver.Chrome(options=chrome_options) </span><br><span class="line">  targetUrl = <span class="string">&#x27;https://www.map.com.tw/&#x27;</span></span><br><span class="line">  browser.get(targetUrl)</span><br><span class="line">  search = browser.find_element_by_id(<span class="string">&#x27;searchWord&#x27;</span>) </span><br><span class="line">  search.clear()                                    </span><br><span class="line">  search.send_keys(addr)</span><br><span class="line">  browser.find_element_by_xpath(<span class="string">&quot;/html/body/form/div[10]/div[2]/img[2]&quot;</span>).click()  </span><br><span class="line">  iframe = browser.find_element_by_class_name(<span class="string">&quot;winfoIframe&quot;</span>)  </span><br><span class="line">  browser.switch_to.frame(iframe)                              </span><br><span class="line">  co_btn = browser.find_element_by_xpath(<span class="string">&quot;/html/body/form/div[4]/table/tbody/tr[3]/td/table/tbody/tr/td[2]&quot;</span>)</span><br><span class="line">  co_btn.click()</span><br><span class="line">  page_results = browser.find_element_by_xpath(<span class="string">&quot;/html/body/form/div[5]/table/tbody/tr[2]/td&quot;</span>)   </span><br><span class="line">  coor = page_results.text.strip().split(<span class="string">&quot; &quot;</span>)</span><br><span class="line">  lat = coor[-<span class="number">1</span>].split(<span class="string">&quot;：&quot;</span>)[-<span class="number">1</span>]         </span><br><span class="line">  lng = coor[<span class="number">0</span>].split(<span class="string">&quot;：&quot;</span>)[-<span class="number">1</span>]</span><br><span class="line">  browser.quit()                                <span class="comment">#關閉網頁</span></span><br><span class="line">  <span class="keyword">return</span> lat, lng</span><br></pre></td></tr></table></figure>

<p>到這邊地址轉經緯度功能差不多做完了，剩下就是一些程式上的優化</p>
<p>當然如果是少量資料這樣跑肯定是沒什麼問題，大量跑起來就會有一些問題出現了</p>
<h3 id="網頁爬蟲多次後讀取超時"><a href="#網頁爬蟲多次後讀取超時" class="headerlink" title="網頁爬蟲多次後讀取超時"></a>網頁爬蟲多次後讀取超時</h3><p><strong>連續開啟網頁多次後，網頁元素還沒有載入完成程式就要存取就會出錯</strong></p>
<p>因為抓不到元素又沒寫例外處理，程式就會直接中斷執行，此時可以加上</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium.webdriver.support.ui <span class="keyword">import</span> WebDriverWait</span><br><span class="line"></span><br><span class="line">===與前面相同===</span><br><span class="line">wait = WebDriverWait(browser,<span class="number">60</span>)                     </span><br><span class="line">iframe = wait.until(<span class="keyword">lambda</span> browser: browser.find_element_by_class_name(<span class="string">&quot;winfoIframe&quot;</span>))  </span><br></pre></td></tr></table></figure>
<p>這段程式碼意思是在存取時等待一段時間存取，存取到才會給網頁元素，沒有就會進入TimeoutException</p>
<p>我的情況是在抓顯示目標地址iframe時候會出現，所以我選擇延後抓取時間，若60秒沒抓到就進例外處理</p>
<p>Python例外若沒進行處理會強制中止程式執行，處理例外可以這樣寫</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium.common.exceptions <span class="keyword">import</span> TimeoutException</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">	browser.get(targetUrl)</span><br><span class="line">	===與前面相同===</span><br><span class="line"><span class="keyword">except</span> TimeoutException <span class="keyword">as</span> t:</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;這次讀取超時&quot;</span>)</span><br><span class="line">    browser.quit()</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>,<span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>讓函式回傳(1,1)表示出現例外情況，讓程式可以自己判斷接下來的操作而不是被強制中止</p>
<h3 id="網頁爬蟲多次後被偵測成機器人"><a href="#網頁爬蟲多次後被偵測成機器人" class="headerlink" title="網頁爬蟲多次後被偵測成機器人"></a>網頁爬蟲多次後被偵測成機器人</h3><p><strong>連續開啟網頁多次後，目標網頁暫時封鎖你的存取使程式無法取得資料</strong></p>
<p>一般來說網頁都會做反爬蟲的機制，因為大量的爬蟲會消耗伺服器的資源，會導致一般用戶的體驗受影響，爬蟲還是要適可而止啊…</p>
<p><strong>一旦被判定成機器人，就直接鎖存取的IP了，此時要再度存取只能換IP來規避封鎖</strong></p>
<p>當然這部分也需要例外處理不然程式照樣中止給你看，寫法可參考</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium.common.exceptions <span class="keyword">import</span> UnexpectedAlertPresentException</span><br><span class="line"></span><br><span class="line">===與前面相同===</span><br><span class="line"><span class="keyword">except</span> UnexpectedAlertPresentException <span class="keyword">as</span> bot:         </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;被偵測成機器人囉!&quot;</span>)</span><br><span class="line">    browser.quit()</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>,<span class="number">1</span></span><br></pre></td></tr></table></figure>
<h4 id="降低被偵測成機器人的機率"><a href="#降低被偵測成機器人的機率" class="headerlink" title="降低被偵測成機器人的機率"></a>降低被偵測成機器人的機率</h4><p>前面也有提到更換請求的用戶代理讓網頁伺服器誤判請求來源，有些情況反而會使原本能抓到的元素抓不到要注意(瀏覽器版本過於老舊某些元件可能不支援或不存在等)</p>
<p>再來就是在完成每次請求資料的時間點讓程式休息一下，python內建語法可使用(單位：秒)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>最好加上隨機變化的休息時間來降低被偵測的機率</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">rest= random.randint(<span class="number">1</span>,<span class="number">5</span>)</span><br><span class="line">time.sleep(rest)</span><br></pre></td></tr></table></figure>
<h2 id="讀取CSV檔案"><a href="#讀取CSV檔案" class="headerlink" title="讀取CSV檔案"></a>讀取CSV檔案</h2><p>這邊提一下我在做這功能時用到的模組，以常見的CSV檔案為例</p>
<p>假設我今天要處理的CSV檔案內容是</p>
<pre><code>楊文昌診所,高雄市林園區東林西路281號
澄品牙醫診所,高雄市林園區林園北路384號
大統內兒科診所,高雄市大寮區鳳林四路五十六號
</code></pre>
<p>以上資料是我從政府開放性平台取得，原生檔案並沒有經緯度存在</p>
<p>那我就能讀取檔案後將內容存在變數 datas 中</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line">file = <span class="string">&#x27;要處理的檔案名稱.csv&#x27;</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(file,encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> csvFile:  <span class="comment"># with open()只在函式內部讀取，離開函式會關檔</span></span><br><span class="line">    csvReader = csv.reader(csvFile)</span><br><span class="line">    datas = <span class="built_in">list</span>(csvReader)</span><br></pre></td></tr></table></figure>


<h2 id="輸出CSV檔案"><a href="#輸出CSV檔案" class="headerlink" title="輸出CSV檔案"></a>輸出CSV檔案</h2><p>將上面取得的經緯度依需求整理成特定格式CSV檔案並儲存輸出到電腦上</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line">outputFile = <span class="string">&#x27;要輸出的檔案名稱.csv&#x27;</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(outputFile, <span class="string">&#x27;w&#x27;</span>, newline=<span class="string">&#x27;&#x27;</span>,encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> csvWrite: </span><br><span class="line">    csvWriter = csv.writer(csvWrite)</span><br><span class="line">    csvWriter.writerow([<span class="string">&#x27;名稱&#x27;</span>, <span class="string">&#x27;地址&#x27;</span>, <span class="string">&#x27;lat&#x27;</span>,<span class="string">&#x27;lng&#x27;</span>])  <span class="comment">#寫入第一行</span></span><br><span class="line">    <span class="keyword">for</span> result <span class="keyword">in</span> datas:</span><br><span class="line">      location = get_coordinate(result[<span class="number">1</span>])</span><br><span class="line">      result.extend([location[<span class="number">0</span>],location[<span class="number">1</span>]])</span><br><span class="line">      <span class="built_in">print</span> (result)                                  <span class="comment">#在終端機印出結果</span></span><br><span class="line">      csvWriter.writerow(result)        			  <span class="comment">#寫入檔案    </span></span><br></pre></td></tr></table></figure>
<p>這邊注意with open的第二個參數</p>
<ul>
<li>‘w’：是每次寫入都重頭開始，若沒找不到檔案會自己產生一個</li>
<li>‘a’：寫入是從檔案的最後一行開始，不會自己產生檔案</li>
</ul>
<p>以上便是我透過網頁爬蟲去將地址轉成經緯度的python程式碼</p>
<p>當然這方法懂之後所有網頁都能適用，網頁反爬蟲的機制也不只被ip封鎖那麼簡單了</p>
<p>像是輸入驗證碼或是圖像驗證之類的在現代網頁反爬蟲也不少見就是，當然也有破解法又是別的故事了…</p>
<p>要成為一名精通網頁爬蟲的工程師之路是很廣闊的啊 ~</p>
<h1 id="參考資料"><a href="#參考資料" class="headerlink" title="參考資料"></a>參考資料</h1><ul>
<li><p><a href="https://ithelp.ithome.com.tw/articles/10225429">iT邦幫忙鐵人賽-【Day 21】反反爬蟲 (2/2)</a></p>
</li>
<li><p><a href="https://selflearningsuccess.com/pythonstring/#%E4%BD%BF%E7%94%A8_Str_%E5%87%BD%E5%BC%8F%E4%BE%86%E5%BB%BA%E7%AB%8B%E5%AD%97%E4%B8%B2">Python字串基礎與20種常見操作</a></p>
</li>
</ul>
]]></content>
      <categories>
        <category>技術筆記</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>網頁爬蟲</tag>
        <tag>地址轉經緯度</tag>
      </tags>
  </entry>
  <entry>
    <title>Raspbain實作筆記</title>
    <url>/2021/12/24/Raspbain%E5%AF%A6%E4%BD%9C%E7%AD%86%E8%A8%98/</url>
    <content><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>簡單記錄一下如何從空機到能正常使用的步驟 </p>
<p>操作基本上使用 Windows作業系統</p>
<h1 id="初次安裝"><a href="#初次安裝" class="headerlink" title="初次安裝"></a>初次安裝</h1><p><strong>在開始安裝前請準備一台『讀卡機』</strong></p>
<span id="more"></span>

<ol>
<li><a href="https://www.raspberrypi.org/downloads/raspbian/">Raspbain官網</a>   </li>
</ol>
<p>→ 下載「Raspbain Buster with desktop」的ZIP檔，作業系統</p>
<ol start="2">
<li><a href="https://www.balena.io/etcher/">balenaEtcher</a></li>
</ol>
<p>→ 下載並安裝，燒錄程式</p>
<ol start="3">
<li><a href="https://mobaxterm.mobatek.net/">Mobaxterm</a></li>
</ol>
<p>→ 下載並安裝，遠端操作</p>
<ol start="4">
<li><a href="https://angryip.org/">angryip</a></li>
</ol>
<p>→ 下載並安裝，掃描樹梅派IP </p>
<h2 id="第一步：燒錄"><a href="#第一步：燒錄" class="headerlink" title="第一步：燒錄"></a>第一步：燒錄</h2><p>將SD卡插入讀卡機並與電腦連接，開啟『balenaEtcher』</p>
<p> <img src="https://i.imgur.com/CW809w5.png" alt="balenaEtcher"></p>
<ol>
<li><p>選擇「Raspbain Buster with desktop」的ZIP檔</p>
</li>
<li><p>選擇「SD卡的磁碟」</p>
</li>
<li><p>等待進度條跑完</p>
</li>
</ol>
<h2 id="第二步：設定網路連線"><a href="#第二步：設定網路連線" class="headerlink" title="第二步：設定網路連線"></a>第二步：設定網路連線</h2><ol>
<li>在SD卡的boot磁區建立檔名為「ssh」的空檔(不要有副檔名)，開啟ssh功能**(預設為關)**</li>
</ol>
<img src="https://i.imgur.com/1p04Q2j.png" alt="ssh" style="zoom:90%;" />

<ol start="2">
<li>在SD卡的boot磁區建立檔名為「<strong>wpa_supplicant.conf</strong>」的檔案</li>
</ol>
<p>  建議<strong>不要用記事本開</strong>，可用 <strong>Nodepad++、Sublime</strong> 等開啟</p>
<p>→ 檔案內容如下：<br><strong>(區分大小寫，失敗返回第一步)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev</span><br><span class="line"></span><br><span class="line">update_config=1</span><br><span class="line"></span><br><span class="line">country=TW</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">network=&#123;</span><br><span class="line"></span><br><span class="line">  ssid=&quot;SSID名稱&quot;</span><br><span class="line"></span><br><span class="line">  psk=&quot;密碼&quot;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>network 部分 為 要連線的WiFi 帳密</p>
<h2 id="第三步：開機"><a href="#第三步：開機" class="headerlink" title="第三步：開機"></a>第三步：開機</h2><ol>
<li><p>樹梅派插上SD卡並開機</p>
<p>→ 注意樹梅派的 燈號是否閃爍</p>
</li>
</ol>
<ul>
<li><p>開機閃爍，SD卡正在讀取，正常</p>
</li>
<li><p>開機不閃爍，樹梅派、SD卡、作業系統三者之一損毀</p>
</li>
</ul>
<h2 id="第四步：找到樹梅派-IP"><a href="#第四步：找到樹梅派-IP" class="headerlink" title="第四步：找到樹梅派 IP"></a>第四步：找到樹梅派 IP</h2><p>在電腦上使用「angryip」搜尋IP</p>
<p><img src="https://i.imgur.com/vgNd5qL.png" alt="ipscan"></p>
<p><strong>預設名稱為「raspberrypi.local」</strong></p>
<p><code>無線網路：樹梅派與電腦需同一網段</code></p>
<p><code>有線網路：需要路由器與網路線手動將電腦與樹梅派置於同一網段</code></p>
<h2 id="第五步：使用網路連線"><a href="#第五步：使用網路連線" class="headerlink" title="第五步：使用網路連線"></a>第五步：使用網路連線</h2><p>SSH：使用 mobaxterm</p>
<p>點選Sessions &gt; New session &gt; SSH </p>
<p><img src="https://i.imgur.com/hAxVTh4.png" alt="MobaXterm"></p>
<p>設定如上圖預設帳號：pi  ，點選OK進入輸入密碼頁面</p>
<p>預設密碼：raspberry  便可成功登入</p>
<h2 id="第六步：系統設定"><a href="#第六步：系統設定" class="headerlink" title="第六步：系統設定"></a>第六步：系統設定</h2><p>編輯檔案推薦使用 nano </p>
<h3 id="主機設定"><a href="#主機設定" class="headerlink" title="主機設定"></a>主機設定</h3><p><code>sudo raspi - config</code></p>
<p>→ 修改密碼 (第一個)</p>
<p>→ 修改樹梅派hostname (第二個) </p>
<p>→ 修改時區 (第四個) </p>
<p>→ 修改WIFI國家( TW ) </p>
<h3 id="WiFi設定"><a href="#WiFi設定" class="headerlink" title="WiFi設定"></a>WiFi設定</h3><p><code>sudo nano /etc/rc.local</code>  </p>
<p>→ 檔案最後加上( 關閉wifi睡眠 )</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">iwconfig wlan0 power off </span><br><span class="line"></span><br><span class="line">iw dev wlan0 set power_save off</span><br></pre></td></tr></table></figure>

<p>儲存後離開，並使用 ifconfig  確認wlan0是否開啟</p>
<h3 id="遠端桌面"><a href="#遠端桌面" class="headerlink" title="遠端桌面"></a>遠端桌面</h3><p><code>sudo apt-get install xrdp</code></p>
<p>→ 在搜尋中輸入mstsc 找到遠端桌面連線並輸入樹梅派 IP 連線</p>
<p>→ 輸入樹梅派帳號密碼存取</p>
<h3 id="安裝vim格式設定"><a href="#安裝vim格式設定" class="headerlink" title="安裝vim格式設定"></a>安裝vim格式設定</h3><p><code>sudo apt-get install vim</code></p>
<p><code>sudo nano /etc/vim/vimrc.local</code></p>
<p> 檔案最後輸入以下內容(格式設定)：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">set tabstop=4 </span><br><span class="line"></span><br><span class="line">set expandtab </span><br><span class="line"></span><br><span class="line">set shiftwidth=4</span><br><span class="line"></span><br><span class="line">set nu</span><br></pre></td></tr></table></figure>
<h3 id="進行系統更新"><a href="#進行系統更新" class="headerlink" title="進行系統更新"></a>進行系統更新</h3><p> <code>sudo apt-get update</code></p>
<p>→ 更新來源清單</p>
<p><code>sudo apt-get-upgrade</code></p>
<p>→ 更新軟體</p>
<h3 id="重開機與關機指令"><a href="#重開機與關機指令" class="headerlink" title="重開機與關機指令"></a>重開機與關機指令</h3><ul>
<li>重開機</li>
</ul>
<p><code>sudo shutdown –r now</code></p>
<p><code>sudo reboot</code></p>
<ul>
<li>關機</li>
</ul>
<p><code>sudo shutdown –h now</code></p>
<h1 id="樹梅派接腳-GPIO"><a href="#樹梅派接腳-GPIO" class="headerlink" title="樹梅派接腳 (GPIO)"></a>樹梅派接腳 (GPIO)</h1><p><strong>注意接腳，隨意接觸可能導致樹梅派燒毀</strong></p>
<p><img src="https://i.imgur.com/3Mfd3ce.png" alt="rasp_1"></p>
<p>在程式選用接腳時不要與現有接腳衝突  </p>
<p><img src="https://i.imgur.com/mcUFttK.png" alt="rasp_2"></p>
]]></content>
      <categories>
        <category>技術筆記</category>
      </categories>
      <tags>
        <tag>Raspbain</tag>
      </tags>
  </entry>
  <entry>
    <title>來用Apache架設簡單WebServer吧</title>
    <url>/2021/12/29/%E4%BE%86%E4%BD%BF%E7%94%A8Apache%E6%9E%B6%E8%A8%AD%E4%B8%80%E5%80%8B%E7%B0%A1%E5%96%AE%EF%BC%B7ebServer%E5%90%A7/</url>
    <content><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>本文安裝環境為 <strong>Ubuntu16.04</strong></p>
<p>提供給初學想要用 Apache 架站的人做參考</p>
<p>會由安裝到 Apache 的細部設定依序說明</p>
<span id="more"></span>

<h1 id="安裝Apache"><a href="#安裝Apache" class="headerlink" title="安裝Apache"></a>安裝Apache</h1><ol>
<li>安裝套件</li>
</ol>
<p>​    <code>sudo apt-get install apache2</code></p>
<ol start="2">
<li>確認安裝完成後啟動服務(兩個指令都行)</li>
</ol>
<p>​    <code>sudo systemctl start apache2</code></p>
<p>​    <code>sudo systemctl start apache2</code></p>
<p>啟用後可以用以下兩個指令查看運作狀態</p>
<p><code>sudo service apache2 status</code></p>
<p><code>sudo systemctl status apache2</code>  </p>
<h1 id="細部設定"><a href="#細部設定" class="headerlink" title="細部設定"></a>細部設定</h1><h2 id="個人首頁設定"><a href="#個人首頁設定" class="headerlink" title="個人首頁設定"></a>個人首頁設定</h2><ol>
<li>啟用個人首頁</li>
</ol>
<p>​    <code>sudo a2enmod userdir</code></p>
<ol start="2">
<li><p>新增個人首頁的設定檔</p>
<p><code>sudo nano /etc/apache2/mods-available/userdir.conf</code></p>
</li>
<li><p>確認防火牆開啟</p>
<p><code>sudo iptables -t filter -L –n</code></p>
</li>
<li><p>重啟 Apache 服務</p>
<p><code>sudo systemctl restart apache2.service</code></p>
</li>
</ol>
<p>這時候在自己帳號的資料夾底下( 通常會是 […/使用者帳號/home/] )</p>
<p>建立 public_html 資料夾</p>
<p><code>mkdir public_html</code></p>
<p>並放上網頁檔案在網址列打上</p>
<p><strong>電腦的ip  / ~使用者名稱 / 檔案名稱</strong></p>
<p>就能看到放上去的網頁了</p>
<h2 id="放置網頁檔案的目錄"><a href="#放置網頁檔案的目錄" class="headerlink" title="放置網頁檔案的目錄"></a>放置網頁檔案的目錄</h2><p>請更改以下檔案</p>
<p><code>sudo nano /etc/apache2/sites-enabled/000-default</code></p>
<p>找到 DocumentRoot 後面改成要改的目錄位置</p>
<h2 id="網頁檔案名稱的設定"><a href="#網頁檔案名稱的設定" class="headerlink" title="網頁檔案名稱的設定"></a>網頁檔案名稱的設定</h2><p>請更改以下檔案</p>
<p><code>sudo nano /etc/apache2/mods-available/dir.conf</code></p>
<p>找到  DirectoryIndex  後面改成要改的檔案名稱 </p>
<h2 id="可能會用到的指令"><a href="#可能會用到的指令" class="headerlink" title="可能會用到的指令"></a>可能會用到的指令</h2><ul>
<li>查看 Apache 版本</li>
</ul>
<p>​        <code>apache2 -v</code></p>
<h3 id="系統時區"><a href="#系統時區" class="headerlink" title="系統時區"></a>系統時區</h3><ul>
<li><p>查看時區</p>
<p><code>timedatectl</code></p>
</li>
<li><p>設定時區</p>
<p><code>sudo timedatectl set-timezone Asia/Taipei </code></p>
</li>
<li><p>查看能設定時區的地區</p>
<p><code>timedatectl list-timezones</code></p>
</li>
</ul>
<h3 id="內部防火牆"><a href="#內部防火牆" class="headerlink" title="內部防火牆"></a>內部防火牆</h3><ul>
<li><p>啟用或停用狀態</p>
<p><code>sudo ufw enable/disable</code></p>
</li>
<li><p>啟用日誌</p>
<p><code>sudo ufw logging on</code></p>
</li>
<li><p>查看狀態及規則</p>
<p><code>sudo ufw status</code></p>
<p><code>sudo ufw status verbose</code></p>
<p><code>sudo ufw status numbered #以數字排列目前防火牆規則</code></p>
<p><code>sudo ufw delete 3 #刪除剛剛查看的第三條防火牆規則</code></p>
<p><code>sudo ufw reset #清空防火牆所有已設置之規則</code></p>
</li>
<li><p>查看需要開放的應用程式</p>
<p><code>sudo ufw app list</code> </p>
</li>
<li><p>查看應用程式開放資訊</p>
<p><code>sudo ufw app info “應用程式名稱”</code></p>
<p>Ex :</p>
<p>要開放 Apache 的通行請打</p>
<p><code>sudo ufw allow in &quot;Apache Full&quot;</code> </p>
</li>
</ul>
<h1 id="沒有實體機器的做法"><a href="#沒有實體機器的做法" class="headerlink" title="沒有實體機器的做法"></a>沒有實體機器的做法</h1><p>請去下載 <a href="https://www.virtualbox.org/wiki/Downloads">Virtualbox</a></p>
<p>裝好 <strong>Ｗindows作業系統</strong> 後</p>
<ol>
<li><p>開機前將網路介面卡設成 <strong>僅限主機的介面卡</strong></p>
</li>
<li><p>開機後使用 終端機指令 查看enp0s3(或其他)位址</p>
<p><code>ipconfig</code></p>
</li>
</ol>
<p>​        假設看到的ip為  <strong>192.168.56.102</strong></p>
<ol start="3">
<li><p>更改C:\Windows\System32\drivers\etc\hosts 檔案內容</p>
<p><strong>預設要先把User權限打開才能編輯</strong></p>
<p>更改的內容如下</p>
<p><img src="https://i.imgur.com/0DG9Vtg.png" alt="hosts內容"></p>
</li>
<li><p>在自己電腦瀏覽器輸入  <a href="http://192.168.56.102/">http://192.168.56.102/</a> 或 <a href="http://guestserver.com/">http://guestserver.com/</a> 就能看到首頁</p>
</li>
</ol>
<h2 id="設定-NAT-Host-only-網卡"><a href="#設定-NAT-Host-only-網卡" class="headerlink" title="設定 NAT + Host-only 網卡"></a>設定 NAT + Host-only 網卡</h2><p>若虛擬機想要連上網路用 Host-only是不行的 </p>
<p>需要設定第二張網卡 NAT</p>
<ul>
<li>查看網卡名稱</li>
</ul>
<p>​        <code>ip link</code></p>
<ul>
<li>更改網路設定檔</li>
</ul>
<p>​        <code>sudo nano /etc/network/interfaces</code></p>
<p>​        更改內容如圖所示</p>
<p><img src="https://i.imgur.com/UcHZXIi.png" alt="interfaces內容"></p>
<ul>
<li><p>啟用寫好的網路介面並重啟網路</p>
<p><code>sudo ifup enp0s8</code></p>
<p><code>sudo /etc/init.d/networking restart</code></p>
</li>
</ul>
]]></content>
      <categories>
        <category>技術筆記</category>
      </categories>
      <tags>
        <tag>Apache</tag>
        <tag>ＷebServer</tag>
      </tags>
  </entry>
  <entry>
    <title>從 0 到 1：Discord Bot 開發之旅</title>
    <url>/2025/02/13/%E5%BE%9E%200%20%E5%88%B0%201%EF%BC%9ADiscord%20Bot%20%E9%96%8B%E7%99%BC%E4%B9%8B%E6%97%85/</url>
    <content><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>使用Discord也有段很長的時間了，使用過各式各樣的群組Bot，</p>
<p>好的群組Bot可以替群組增加許多有趣功能，增添社群的趣味性，</p>
<p>筆者身為工程師也想做一個出來，至少資料都看得到存在哪，不會因為哪天服務停止就全消失了。</p>
<p>此篇文章不會深入如何從 Discord 開發者模式去創建新Bot，僅開發完成的功能進行說明。</p>
<p><img src="https://i.imgur.com/tyYQXkn.png"></p>
<span id="more"></span>

<h1 id="核心功能介紹"><a href="#核心功能介紹" class="headerlink" title="核心功能介紹"></a>核心功能介紹</h1><p>以前有開發過用對話輸入特殊格式訊息觸發Bot指令，</p>
<p>後來發現有 Slash Command 能更加客製化會方便許多，</p>
<p>以下功能全部使用 Slash Command 開發，</p>
<p>大部分指令提供給所有身分，</p>
<p>但有些指令關係到群組設定會限定身分使用。</p>
<h2 id="關鍵字回應"><a href="#關鍵字回應" class="headerlink" title="關鍵字回應"></a>關鍵字回應</h2><p>當成員輸入某個關鍵字會回應特定訊息</p>
<p><img src="https://i.imgur.com/7RtNQra.png"></p>
<h3 id="新增"><a href="#新增" class="headerlink" title="新增"></a>新增</h3><p><img src="https://i.imgur.com/UFo1nJq.png"></p>
<h3 id="查看"><a href="#查看" class="headerlink" title="查看"></a>查看</h3><p><img src="https://i.imgur.com/QBE1bHD.png"></p>
<h3 id="刪除"><a href="#刪除" class="headerlink" title="刪除"></a>刪除</h3><p><img src="https://i.imgur.com/OLmr2MU.png"></p>
<h2 id="成員歡迎-離開訊息"><a href="#成員歡迎-離開訊息" class="headerlink" title="成員歡迎/離開訊息"></a>成員歡迎/離開訊息</h2><p><img src="https://i.imgur.com/ypsOGww.png"></p>
<h3 id="設定"><a href="#設定" class="headerlink" title="設定"></a>設定</h3><p><strong>該功能只有能群組管理員才能操作</strong></p>
<p><img src="https://i.imgur.com/I1W8e2a.png"></p>
<h2 id="時間提醒任務"><a href="#時間提醒任務" class="headerlink" title="時間提醒任務"></a>時間提醒任務</h2><p><img src="https://i.imgur.com/FQZWNox.png"></p>
<h3 id="新增-1"><a href="#新增-1" class="headerlink" title="新增"></a>新增</h3><p><img src="https://i.imgur.com/Met4cKl.png"></p>
<h3 id="查看-1"><a href="#查看-1" class="headerlink" title="查看"></a>查看</h3><p><img src="https://i.imgur.com/wYtOqi9.png"></p>
<h2 id="重複成員訊息"><a href="#重複成員訊息" class="headerlink" title="重複成員訊息"></a>重複成員訊息</h2><p><img src="https://i.imgur.com/wFTmQMS.png"></p>
<h2 id="刪除多筆訊息"><a href="#刪除多筆訊息" class="headerlink" title="刪除多筆訊息"></a>刪除多筆訊息</h2><p><strong>該功能只有能刪除訊息的使用者才能操作</strong></p>
<p><img src="https://i.imgur.com/w6oUud0.png"></p>
<h1 id="技術架構"><a href="#技術架構" class="headerlink" title="技術架構"></a>技術架構</h1><p>使用 JavaScript進行開發，</p>
<p>在 Node.js(v18.20.5) 及 discord.js (v14.17.3) 環境運行，</p>
<p>啟動資訊放在專案的 main.js 下，</p>
<p>啟動時會載入相關設定，並設定前端網站(顯示運作狀態)，</p>
<p>主要功能都集中在 src 資料夾下，</p>
<p>在底下依功能性區分資料夾，</p>
<p><strong>commands：</strong>指令</p>
<p><strong>core：</strong>啟動時載入的設定</p>
<p><strong>events：</strong>監聽事件</p>
<p><strong>routes：</strong>前端顯示</p>
<p><strong>store：</strong>狀態及存取資料管理</p>
<p><strong>logs：</strong>運作日誌</p>
<p><strong>utils：</strong>共通工具</p>
<p>目前資料儲存讀取是都在專案下的Json檔案內，</p>
<p><strong>關鍵字回應：</strong> replies</p>
<p><strong>時間提醒：</strong> reminders</p>
<p><strong>歡迎/離開訊息：</strong>settings</p>
<p>依照 <strong>不同群組</strong> 區分儲存內容，</p>
<p>依Discord回應設定有分成 私密 與 非私密 訊息，</p>
<p>私密訊息可以自己刪除，</p>
<p>但非私密訊息就需要能刪除的人砍訊息了。</p>
<p>部署到網路我是採用 Heroku方式，</p>
<p>官方文件寫得很詳細，計費方案也很透明，</p>
<p>省去申請網域名稱的問題，也提供實際運作上的效能圖表，</p>
<p>方便查看上線後運行情況。</p>
<h1 id="未來規劃"><a href="#未來規劃" class="headerlink" title="未來規劃"></a>未來規劃</h1><h2 id="調整資料儲存方式"><a href="#調整資料儲存方式" class="headerlink" title="調整資料儲存方式"></a>調整資料儲存方式</h2><p>目前做法雖然方便，可以直接查看設定內容，</p>
<p>但存儲資料應在資料庫較好，</p>
<p>部署上Heroku 每次啟動都會重建檔案內容，</p>
<p>讓上次新增的資料全部重置也是個問題。</p>
<h2 id="新增更多功能"><a href="#新增更多功能" class="headerlink" title="新增更多功能"></a>新增更多功能</h2><p>給予身分組：自動給予成員身分組</p>
<p>隨機抽獎：設定抽獎範圍與數量抽出結果</p>
<p>成員管理：禁言違規用戶</p>
<p>音樂播放：支援 YouTube、Spotify 串流播放</p>
<p>API 整合：天氣查詢</p>
<h1 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h1><p>基本上為個人開發，</p>
<p>技術上還不是很成熟，</p>
<p>若願意提出意見我會十分感謝，</p>
<p>感謝你看到這邊，最後附上專案位置，</p>
<p><a href="https://github.com/Chitoseyu/js-dicord-bot">https://github.com/Chitoseyu/js-dicord-bot</a></p>
]]></content>
      <categories>
        <category>程式專案</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>Node.js</tag>
        <tag>Discord.js</tag>
      </tags>
  </entry>
  <entry>
    <title>藍芽室內定位的可行性</title>
    <url>/2022/01/12/%E8%97%8D%E8%8A%BD%E5%AE%A4%E5%85%A7%E5%AE%9A%E4%BD%8D%E7%9A%84%E5%8F%AF%E8%A1%8C%E6%80%A7/</url>
    <content><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>大學專題有思考過類似的問題，並有實際去嘗試過才想寫這主題。</p>
<p>因為室內定位真的是一門很廣的學問，何況藍芽的訊號干擾太多了，實作起來能說是困難重重…</p>
<span id="more"></span>


<h1 id="專題簡介"><a href="#專題簡介" class="headerlink" title="專題簡介"></a>專題簡介</h1><p>大學專題的作品名稱是 『 行動導覽系統 』，</p>
<p>跟另外兩名大學同學一組，</p>
<p>我主要負責報告文件整理及統整其他技術研究等，</p>
<p>看過各種關於藍牙室內定位的論文或研究，</p>
<p>看到最後好像也沒有一個很完美的做法…</p>
<p>這邊放上當初做的海報擷取來說明主要功能<br><img src="https://i.imgur.com/9pIPg8F.png"></p>
<p>就是透過手機程式來定位到在特定位置的展物並顯示出展物資訊</p>
<p>聽起來好像很簡單但做了才發現問題很多…</p>
<ul>
<li>訊號精準度若偏差太大定位點會偏離</li>
<li>藍芽訊號太容易受干擾</li>
<li>距離不同收到的訊號強度也不同</li>
<li>放太近訊號會互相干擾</li>
<li>展覽場地不同要配置幾個才夠定位</li>
</ul>
<p>以下就用專題中遇到的不同技術困難點做分段說明。</p>
<h1 id="定位設備-Beacon"><a href="#定位設備-Beacon" class="headerlink" title="定位設備 - Beacon"></a>定位設備 - Beacon</h1><p>當初實驗室剛好手邊有這個 - 智石科技的Ｍax Beacon<br><img src="https://i.imgur.com/f4TlFY8.jpg" alt="Beacon"><br>設備規格如下圖所示<br><img src="https://i.imgur.com/U5vc8Mg.png"></p>
<p>防水防塵防震動，<br>提供App 可以搜尋調整Beacon訊號的強弱及推播頻率和看電池電量等功能。</p>
<p>每個 Beacon 都有獨立的一個編號(如：47044)</p>
<p>為什麼要採用這個，主要原因如下：</p>
<ol>
<li>單一設備便宜(約4.500元 / 個)</li>
<li>配置簡單(與無線訊號台AP比較)</li>
<li>藍芽已被廣大運用在各類產品</li>
<li>實驗室剛好有</li>
</ol>
<p>Beacon可以發送訊號給手機接收，不同距離的訊號強度也不同</p>
<p><strong>用這些不同的訊號強度來判斷使用者目前在場地的哪個地方</strong></p>
<h2 id="設備狀態"><a href="#設備狀態" class="headerlink" title="設備狀態"></a>設備狀態</h2><p>這些編號跟訊號強弱有關係，若壞掉的訊號就異常需排除在外</p>
<p>我們第一步做的就是從一堆 Beacon 中排除訊號異常的部分</p>
<p>廠商提供的訊號正常範圍為 -50 ~ -90 dBm(一公尺)</p>
<p>但又不能把他們放太近測試，<strong>藍芽訊號非常容易受干擾</strong></p>
<p>於是就分別量測不同編號的訊號強度，如下圖所示，</p>
<p><img src="https://i.imgur.com/orXyRnn.png" alt="編號訊號強度比較"></p>
<p>這資料是依 1m 不同推播頻率的Beacon來做比較，</p>
<p>使用 APP 調整編號的 TXPOWER(會影響訊號推播強度)，</p>
<p><strong>依這個數據將與其他人訊號有差異的裝置排除不使用</strong>。</p>
<h2 id="設備推播範圍"><a href="#設備推播範圍" class="headerlink" title="設備推播範圍"></a>設備推播範圍</h2><p>基本上 Beacon 的訊號可以超過 3 m 沒問題，</p>
<p>但室內並不需要那麼廣的推播範圍，</p>
<p>而前面也提到 TXPOWER 會影響訊號強度，</p>
<p>於是我們以 1 m 不同 TXPOWER 來看訊號變化，如圖所示，</p>
<p><img src="https://i.imgur.com/iVrncd0.png" alt="不同推播訊號強度"></p>
<p>可以看到 <strong>4dBm 是訊號強度最強的時候，越往下調整越弱</strong>。</p>
<h2 id="設備維持時間"><a href="#設備維持時間" class="headerlink" title="設備維持時間"></a>設備維持時間</h2><p>對於Beacon能維持正常狀態多少時間也有花時間測試，</p>
<p>具體狀況如下圖所示，以正常推播頻率放置超過半年，</p>
<p>4dBm是 TXPOWER 最強訊號強度的情況，</p>
<p><img src="https://i.imgur.com/GlU4VcD.png" alt="Beacon電池狀況"></p>
<p><strong>基本上跟三號電池的衰減曲線差不多符合，在續航力上不太需要擔心</strong>。</p>
<h1 id="Bluetooth-藍芽"><a href="#Bluetooth-藍芽" class="headerlink" title="Bluetooth 藍芽"></a>Bluetooth 藍芽</h1><p>作為室內定位的主技術，也有很長發展歷史…有興趣的就自己去研究吧</p>
<p>採用的是藍芽4.0後出現的 低功耗藍牙BLE 技術，比較如下圖，</p>
<p><img src="https://i.imgur.com/jJu1J48.png" alt="與傳統藍芽比較"></p>
<p>在找資料的時候發現藍芽是非常容易受干擾的東西，</p>
<p>什麼都會對訊號造成干擾，通常稱為多重訊號干擾，如下圖所示，</p>
<p><img src="https://i.imgur.com/FOhpGW1.jpg" alt="藍芽干擾"></p>
<p>那參考別人的論文後發現他們有有遇過類似的問題，</p>
<p>此時他們提出的解決方法是 - 訊號濾波，</p>
<p>將收到的訊號做一次過濾，也就是把過高或過低的訊號值移除，</p>
<p>濾波器也有很多種，像是均值濾波器跟卡爾曼濾波器等等</p>
<p>但均值濾波器在處理上反應時間較久，不適合用在即時處理的應用上，</p>
<p>所以我們採用的是卡爾曼濾波器，這裡就不贅述它的原理了，</p>
<p>經過濾波器處理後，訊號強度確實有變規律一點。</p>
<h2 id="定位方法"><a href="#定位方法" class="headerlink" title="定位方法"></a>定位方法</h2><p>室內定位也有很多方法被使用，定位的根據不同方法也不同，</p>
<p>我們這邊是採用 <strong>RSSI 接收強度定位法</strong>，</p>
<p>接收不同的訊號強度轉換成距離後透過三角定位法求出接收器的位置</p>
<p>稱為 RSSI 三點定位法也稱三角定位法。</p>
<p>但距離跟訊號強度的關係不明顯就會使定位不精準，</p>
<p>所以我們採用的是另一種稱為<strong>指紋定位法</strong>的方法，如圖所示，</p>
<p><img src="https://i.imgur.com/m0hfTBX.png" alt="指紋定位法"></p>
<p>用大量搜集不同區塊所收得的訊號強度當成區域特徵後儲存於資料庫，</p>
<p>需要定位時則透過當下收到的特徵去比對資料庫中較符合的區塊回傳。</p>
<h2 id="定位場域"><a href="#定位場域" class="headerlink" title="定位場域"></a>定位場域</h2><p>最一開始我們是用實驗室當場域，</p>
<p>呈現一個長方形，<del>然後訊號干擾超嚴重</del>，</p>
<p>後來選用學校的一間教室，平面圖如下，</p>
<p><img src="https://i.imgur.com/EnI61MP.png" alt="教室平面圖"></p>
<p>因為前面選用的定位方法，把這地方切成數區塊如下圖所示，</p>
<p><img src="https://i.imgur.com/GRHvAos.jpg" alt="切割教室圖"></p>
<p>大致上的想法是走到哪個地方那區塊就會發亮，</p>
<p>表示使用者現在走到這個區塊內了，可以顯示區塊的資訊。</p>
<h2 id="場域配置數量"><a href="#場域配置數量" class="headerlink" title="場域配置數量"></a>場域配置數量</h2><p>決定好場地後再來就是要配置幾顆 Beacon 才夠用了，</p>
<p>這時我看到成功大學有一篇論文在研究訊號特徵法，</p>
<p>就模仿他的方法來做我們的預估配置狀況，如下圖所示，</p>
<p>考慮過若配置3顆的情況，<br><img src="https://i.imgur.com/x2CpETR.png" alt="理論3顆配置"><br>或是配置4顆的情況，<br><img src="https://i.imgur.com/blrZVJ6.png" alt="理論4顆配置"></p>
<p>以顏色來分辨訊號強度，我的訊號強度顏色如下圖所示，</p>
<p><img src="https://i.imgur.com/XgwjlSe.png" alt="訊號強度顏色"></p>
<p>因為場地不大所以配置數量 4 顆就算多了，再往上會互相干擾…</p>
<p>那我們選用 3 顆的配置方法，</p>
<p>並開始去搜集這區塊的訊號強度到資料庫中。</p>
<h1 id="實作成果"><a href="#實作成果" class="headerlink" title="實作成果"></a>實作成果</h1><p>最後讓負責手機程式的同學開發後的成果如下圖，<br><img src="https://i.imgur.com/7ciy3bv.png" alt="App畫面-定位區塊"></p>
<p>假設場地上有各種畫作，若剛好Ａ4 區域有東西顯示，會如下圖所示，<br><img src="https://i.imgur.com/QTJwvEF.png" alt="App畫面-導覽畫面"></p>
<p>但有時候會定位在別的區塊上也是個問題，</p>
<p>定位精準度經過我們處理還是不高…</p>
<p>離實際要應用在導覽場域還有很大一段距離。</p>
<h1 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h1><p><del><strong>專題千萬不要做藍芽室內定位</strong></del></p>
<p>如果時間很多又想挑戰新領域的人可以嘗試，</p>
<p>但其中要花費的時間絕對遠超你的預期，</p>
<p>我很肯定你們大多數時間都在處理和調整非程式的因素</p>
<p>作為大學的畢業專題來說，</p>
<p>說真的超出一般大學生能處理的東西了，</p>
<p>考慮和影響的東西太多，什麼配置方法什麼地點都要自己決定，</p>
<p>技術成果不算完美，從裡面學到了不少實驗方法與解決問題的想法，</p>
<p>也感謝配合指導教授和我任性實驗要求的組員們，</p>
<p>提供給之後想做 <strong>藍芽室內定位</strong> 的人參考。</p>
<h1 id="參考文獻"><a href="#參考文獻" class="headerlink" title="參考文獻"></a>參考文獻</h1><p>這邊就提供當初寫報告有參考的論文，如圖所示，</p>
<p><img src="https://i.imgur.com/BHn5d52.png" alt="參考論文"></p>
<p>這些論文也給當初在研究的我們不少啟發，</p>
<p>有興趣的人也可以去看看！</p>
]]></content>
      <categories>
        <category>技術筆記</category>
      </categories>
      <tags>
        <tag>藍芽</tag>
        <tag>室內定位</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux常用語法</title>
    <url>/2021/12/22/Linux%E5%B8%B8%E7%94%A8%E8%AA%9E%E6%B3%95/</url>
    <content><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>開始整理大學時期研究的筆記</p>
<p>也替自己的學習做一點紀錄</p>
<p>放個Linux吉祥物做開頭吧</p>
<p><img src="/images/Linux_icon.png"></p>
<p>Linux作業系統有發行很多種版本</p>
<p>例如：CentOS、Ubuntu…等都算是Linux的一種</p>
<p>但終端機用的指令通常都大同小異</p>
<p>也藉由這文章做個整理</p>
<span id="more"></span>

<h1 id="Linux語法"><a href="#Linux語法" class="headerlink" title="Linux語法"></a>Linux語法</h1><p>以下依照功能用途來區分常用指令</p>
<h2 id="系統操作"><a href="#系統操作" class="headerlink" title="系統操作"></a>系統操作</h2><table>
<thead>
<tr>
<th>指令</th>
<th>說明</th>
<th>用法</th>
</tr>
</thead>
<tbody><tr>
<td>lsb_release</td>
<td>查看目前ubuntu版本</td>
<td>lsb_release -a</td>
</tr>
<tr>
<td>dpkg</td>
<td>列出安裝套件</td>
<td>dpkg -l  grep php</td>
</tr>
<tr>
<td>route</td>
<td>查看路由表</td>
<td>route -n</td>
</tr>
</tbody></table>
<h2 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h2><table>
<thead>
<tr>
<th>指令</th>
<th>說明</th>
<th align="left">用法</th>
</tr>
</thead>
<tbody><tr>
<td>ls</td>
<td>查看目前所在位置的所有檔案</td>
<td align="left">ls</td>
</tr>
<tr>
<td>mkdir</td>
<td>建立新資料夾</td>
<td align="left">mkdir html</td>
</tr>
<tr>
<td>cd</td>
<td>移動到該資料夾下</td>
<td align="left">cd html</td>
</tr>
<tr>
<td>passwd</td>
<td>使用者更改自己帳號的密碼</td>
<td align="left">Passwd</td>
</tr>
<tr>
<td>apt update</td>
<td>更新系統</td>
<td align="left">sudo apt update</td>
</tr>
<tr>
<td>apt upgrade</td>
<td>更新系統現有套件</td>
<td align="left">sudo apt upgrade</td>
</tr>
<tr>
<td>apt dist-upgrade</td>
<td>更新系統套件相依性</td>
<td align="left">sudo apt dist-upgrade</td>
</tr>
<tr>
<td>shutdown</td>
<td>系統關機(-c 取消關機 -r重新開機)</td>
<td align="left">sudo shutdown -h now</td>
</tr>
</tbody></table>
<h2 id="檔案處理"><a href="#檔案處理" class="headerlink" title="檔案處理"></a>檔案處理</h2><table>
<thead>
<tr>
<th>指令</th>
<th>說明</th>
<th align="left">用法</th>
</tr>
</thead>
<tbody><tr>
<td>nano(vi)</td>
<td>編輯器新增或編輯檔案(nano或vi 看使用者習慣)</td>
<td align="left">nano  index.html</td>
</tr>
<tr>
<td>mv</td>
<td>檔案改名或移動到特定位置</td>
<td align="left">mv index.html newIndex.html</td>
</tr>
<tr>
<td>find</td>
<td>尋找檔案(可在檔案名稱變化：?單字元、*多字元)</td>
<td align="left">find / -name newIndex.*</td>
</tr>
<tr>
<td>cp</td>
<td>複製檔案</td>
<td align="left">cp newIndex.html index.txt</td>
</tr>
</tbody></table>
<p>這邊說明檔案權限的區分規則</p>
<p>主要有三個用戶  User(個人) / Group(群組) / Other(其他) 順序排列</p>
<p><code>r :  可讀權限, 數字是 4</code></p>
<p><code>w : 寫入權限, 數字是 2</code></p>
<p><code>x :  執行權限, 數字是 1</code></p>
<p><code>-:  刪除權限, 數字是 0</code></p>
<p><strong>通常會是三個一組，採加法可得出數字</strong></p>
<p><code>7 = 4 (讀) + 2 (寫) + 1 (執行)</code></p>
<p><code>5 = 4 (讀) + 1 (執行)</code></p>
<p><code>4 = 4 (讀)</code></p>
<p>舉個例子</p>
<p>要使 index.html 個人可以讀寫執、群組讀寫、其他讀：</p>
<p>chmod rwx,rx,r index.html    </p>
<p>也等於</p>
<p>chmod 754 index.html</p>
<h2 id="使用者管理"><a href="#使用者管理" class="headerlink" title="使用者管理"></a>使用者管理</h2><table>
<thead>
<tr>
<th>指令</th>
<th>說明</th>
<th align="left">用法</th>
</tr>
</thead>
<tbody><tr>
<td>cat</td>
<td>預覽檔案全部內容並印出</td>
<td align="left">cat index.html</td>
</tr>
<tr>
<td>/etc/group</td>
<td>目前系統存在的群組</td>
<td align="left">cat /etc/group</td>
</tr>
<tr>
<td>groups</td>
<td>查看帳號群組</td>
<td align="left">groups</td>
</tr>
<tr>
<td>groupadd</td>
<td>新增群組(G_ID:不重複的五位數 G_NAME:群組名稱)</td>
<td align="left">groupadd -g G_ID G_Name</td>
</tr>
<tr>
<td>/etc/passwd</td>
<td>目前系統存在的帳號</td>
<td align="left">cat /etc/passwd</td>
</tr>
<tr>
<td>useradd</td>
<td>新增使用者帳號(U_ID:不重複的數字 G:加入的群組 -m:建立目錄 U_N:使用者帳號）</td>
<td align="left">useradd -u U_ID -g G -m U_N</td>
</tr>
<tr>
<td>userdel</td>
<td>刪除使用者帳號(-r:連家目錄一起刪除)</td>
<td align="left">userdel -r U_N</td>
</tr>
<tr>
<td>su</td>
<td>管理帳號與使用者帳號切換</td>
<td align="left">su -l U_N</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>技術筆記</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
</search>
